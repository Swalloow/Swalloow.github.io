{"componentChunkName":"component---src-templates-post-js","path":"/eks-vpc-cni/","result":{"data":{"contentfulPost":{"title":"EKS의 VPC 네트워크 구성 이해하기","slug":"eks-vpc-cni","metaDescription":null,"publishDate":"November 04, 2019","publishDateISO":"2019-11-04","tags":[{"title":"DevOps","id":"5a31222a-01e6-5627-8680-b50849114510","slug":"devops"}],"heroImage":{"title":"cover-devops","gatsbyImageData":{"images":{"sources":[{"srcSet":"https://images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=270&h=180&q=50&fm=webp 270w,\nhttps://images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=540&h=360&q=50&fm=webp 540w,\nhttps://images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=1080&h=720&q=50&fm=webp 1080w","sizes":"(min-width: 1080px) 1080px, 100vw","type":"image/webp"}],"fallback":{"src":"https://images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=1080&h=720&fl=progressive&q=50&fm=jpg","srcSet":"https://images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=270&h=180&fl=progressive&q=50&fm=jpg 270w,\nhttps://images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=540&h=360&fl=progressive&q=50&fm=jpg 540w,\nhttps://images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=1080&h=720&fl=progressive&q=50&fm=jpg 1080w","sizes":"(min-width: 1080px) 1080px, 100vw"}},"layout":"constrained","width":1800,"height":1200,"placeholder":{"fallback":"data:image/jpeg;base64,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"}},"ogimg":{"src":"https://images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=1800&q=50"}},"body":{"childMarkdownRemark":{"timeToRead":3,"html":"<p>모든 Kubernetes as a Service가 그렇듯 EKS 역시 빠르게 변화하고 있습니다.\n오늘의 주제는 EKS의 VPC 네트워크 구성과 CNI 플러그인 입니다.</p>\n<br>\n<h2 id=\"aws-vpc\" style=\"position:relative;\"><a href=\"#aws-vpc\" aria-label=\"aws vpc permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AWS VPC</h2>\n<p><span\n        class=\"gatsby-resp-image-wrapper\"\n        style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\"\n      >\n        <span\n          class=\"gatsby-resp-image-background-image\"\n          style=\"padding-bottom: 86%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAiCAIAAACiBwxcAAAEs0lEQVRYw8VXz28bRRTOX8mNAxIXJCROIAEHygEhBGcOqCAOlFJKol5AVChIUWkikiZKUrXUjn+u7V17vbZ3d37P7OzyzWxihSRICLvwtLHWM5P55r33zfeeN6ratKoErf5D28BfURRi5y7f+lD2nnGluVJcKv4PrCzLlYCzdKE7p6a5b+JA9BtsZ1MlkS4KrY3+GzPGMG+rAecEn7aq8ixjm5+Jr97k397K4zHGswxjN5gQ0piCELIa8HxWacGyhSSZGjTJH09E+2kpWWVUpWVl/KPdU7pHlEpks1jSjJB8JWCezavSUkKM0bYsf9n+LYwmZWkvAq3q4LoXpWxhKhebVAsu2WoeS+oOThnD7ozz4+OnvV6QzGagmKEZfXib7txTJNOFxREIpaBUnudGKbUycOaAKcW+QogoHJ21Wo1mk3BRkTn/+g1++zW5c7fgFCQmLjDGA8v1ASsF4NFweOaNMl5VpT7eZl+8St7eUMe/OmBKXxZwlqZxHM/n88Jav6bUBz/xz18pmgeV9xgZfynAl6cpJcNROBoOemeNQRDgKADGyjRNjVbrBIYeLefwPnEWg3HaFEqbehDL4ukUZ1ScvhTg4XC4f3Dw5PBoFEbLQRyisGXqlCUVNF/bdXLYwhtji1kynUTxOEriieBMSCmkEpQUDCkmWJnNk+s7Yq7b7SbTJAzDKBr3ul3Q5WZguphVZUHzTEsBJalsURXaJgMbNsrxWZkEZdyzWVyBa1CRR5tq69PF0SOQi+Up5wL5hohi99FoFEVRp90+OTkJggDw7XbnrNns9/v+ENFiscBi1KQLyQSwYnQx1TStNK+MgIJWil99IJZkLn74RH3z7mL7HmCprxP1jlEU7nrb29t7cng4nSY4DQiSJMlkMt7b2338eNfxJY5xKc6BySKBi/DYOI+LoNtDLPFSQR2tcTFwYfDvtohPfw8e3otaL4zknDps8FxKfOHdTqfZbDYajVarjQMhF/AP1MEURhEALKv152qOUXCQ4AcPfu50+hJXyyVV8kXC51OXXT8yjuMQB09mhdH5PLHWmgtbVszrI5enbmC19pKJa9vvB+PxmAkXc7H1Mf/+Ax28gJrYEsuYtSUOzihBQVuvZA46nc5gMEAckVpx/xb78nV+5x3dfWadclGwA1SiJFd8jcrFOTwGMIiAwLoGIWyJ794nb23w+x+VPiNYNp1O/c1bq2SW1sKnZT8FL3XvOb3zntz/sV4GjoCxay2Lf1Uu346lPSR8OOyiRA+GprDci/n6i8RlYPDr6Ojo5PR0PIkvC7hv09YD7K8TZWA19nWUR6ytjcbjbq/farf7waDw5pvLJfDKoeb+VtTX6bzVgjdxoEZNFTZ13FeTjpqF9WW0vki7HOOSrwjsJNNIms40y897SjyC4ESVJAhIJXL3uZwyMkeXSVK6YpeJuC09vjKNW8vcL4YbSpCUauW+OjsHXurZOY8Ye/78GeR3Npvb8zboMrBcHTir6YqNwBjs6D8FSlvbG5QfVaWeqg3qj6/rAYZBPS7/JsPuxBver0zVDF8DMCJ55acfvqKkHx4enp4+Rf2+/p9rCDWC5nqZmwzFYOn3dat7iX8P/L/Yn7kYamkaEgxuAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n        >\n          <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"vpc default\"\n        title=\"\"\n        src=\"https://images.ctfassets.net/tushy4jlcik7/6o1qOuWifPux7wixcSmgXV/b92e502ce80d4d069cf6625ad74d8251/vpc_default.png\"\n        srcset=\"https://images.ctfassets.net/tushy4jlcik7/6o1qOuWifPux7wixcSmgXV/b92e502ce80d4d069cf6625ad74d8251/vpc_default.png?w=175 175w,\nhttps://images.ctfassets.net/tushy4jlcik7/6o1qOuWifPux7wixcSmgXV/b92e502ce80d4d069cf6625ad74d8251/vpc_default.png?w=350 350w,\nhttps://images.ctfassets.net/tushy4jlcik7/6o1qOuWifPux7wixcSmgXV/b92e502ce80d4d069cf6625ad74d8251/vpc_default.png?w=700 700w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n        </span>\n      </span></p>\n<p>아마 AWS를 production 환경에서 사용하고 있다면 VPC 구성은 이미 잘 이해하고 계시리라 생각합니다.\nVPC 내에 생성한 인스턴스는 eth0이라는 기본 네트워크 인터페이스를 가지게 됩니다.\n그리고 네트워크 인터페이스에 하나 이상의 IPv4 또는 IPv6 주소를 할당할 수 있습니다.\n또한 각 Subnet에 존재하는 인스턴스는 Route Table을 통해 통신을 할 수 있습니다.\n여기까지가 우리가 알고 있는 VPC 내의 Host 간 통신입니다.</p>\n<p>그렇다면 EKS는 어떤 점이 다를까요?\n쿠버네티스의 Pod은 <strong>한 개 이상의 컨테이너를 구성</strong>하고 같은 Host와 Network 스택을 공유합니다.\n그리고 여러 Host에 사이에 걸쳐 생성된 Pod은 <strong>Overlay Network</strong>를 통해 서로 통신하게 됩니다.\n기존 VPC 환경에서는 Pod 네트워크 통신을 기존 방식처럼 지원하기 어려웠습니다.</p>\n<p>하지만 대부분의 사용자들이 VPC 기반의 인프라를 구성하고 있었기 때문에\nEKS는 VPC를 지원할 수 있어야 했습니다.\n예를 들어 사용자는 Security Group, VPC Flow 로그 등의 기능을 그대로 사용하면서,\nPrivateLink를 통해 다른 AWS 서비스와 통신할 수 있어야 합니다.\n이 문제를 해결하기 위해 AWS는 CNI 라는 네트워크 플러그인을 지원하기 시작했습니다.</p>\n<br>\n<h2 id=\"eks-cni\" style=\"position:relative;\"><a href=\"#eks-cni\" aria-label=\"eks cni permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EKS CNI</h2>\n<p><span\n        class=\"gatsby-resp-image-wrapper\"\n        style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\"\n      >\n        <span\n          class=\"gatsby-resp-image-background-image\"\n          style=\"padding-bottom: 54.285714285714285%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n        >\n          <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"eks-cni\"\n        title=\"\"\n        src=\"https://images.ctfassets.net/tushy4jlcik7/1ZE4A9apz0TNm9p20VzoK3/7f36a5c0f3555aee3265c9b1ce51e90c/cni.png\"\n        srcset=\"https://images.ctfassets.net/tushy4jlcik7/1ZE4A9apz0TNm9p20VzoK3/7f36a5c0f3555aee3265c9b1ce51e90c/cni.png?w=175 175w,\nhttps://images.ctfassets.net/tushy4jlcik7/1ZE4A9apz0TNm9p20VzoK3/7f36a5c0f3555aee3265c9b1ce51e90c/cni.png?w=350 350w,\nhttps://images.ctfassets.net/tushy4jlcik7/1ZE4A9apz0TNm9p20VzoK3/7f36a5c0f3555aee3265c9b1ce51e90c/cni.png?w=700 700w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n        </span>\n      </span></p>\n<p>CNI 는 다음과 같은 통신을 지원합니다.</p>\n<ul>\n<li>단일 Host 내에 존재하는 Pod 간의 통신</li>\n<li>서로 다른 Host 내에 존재하는 Pod 간의 통신</li>\n<li>Pod 과 다른 AWS 서비스 간의 통신</li>\n<li>Pod 과 온프레미스 데이터 센터 간의 통신</li>\n<li>Pod 과 인터넷 간의 통신</li>\n</ul>\n<p>앞서 말했듯 VPC 내의 EC2는 여러 개의 ENI 를 가질 수 있으며,\nENI 는 여러 개의 IP 주소를 가질 수 있습니다.\n하지만 인스턴스 유형 별 가질 수 있는 ENI 와 주소의 최대 수에는 제한이 있습니다.\n만약 EC2 인스턴스가 N개의 ENI와 M개의 주소를 가질 수 있다면 최대 IP는 아래와 같이 계산됩니다.</p>\n<p><code class=\"language-text\">Max IPs = min((N * M - N), subnet's free IP)</code></p>\n<p>처음 Worker Node가 추가되면 하나의 ENI 가 인스턴스에 할당됩니다.\n하지만 실행되는 Pod의 수가 단일 ENI 에서 허용하는 주소를 초과하면 CNI는 노드에 새로운 ENI 를 추가합니다.\nENI 에 secondary IP 할당과 Pod에 할당할 노드의 IP 주소 풀 관리는 <strong>L-IPAM</strong> 데몬을 통해 이루어집니다.\nL-IPAM 데몬은 모든 노드에 DeamonSet으로 배포되며 gRPC를 통해 CNI 플러그인과 통신합니다.</p>\n<p>사용하고 있는 인스턴스 유형이 m5.xlarge라고 가정하고 예시를 들어보겠습니다.\n우선 m5.xlarge 유형은 4 ENI 와 ENI 당 15 개의 IP 주소를 가질 수 있습니다.\n배포된 Pod의 수가 0에서 14 사이라면 IPAM 데몬은 2개의 Warm Pool을 유지하기 위해 ENI를 하나 더 할당합니다.\n이때 사용가능한 IP 수는 <code class=\"language-text\">2 * (15 - 1) = 28</code> 개가 됩니다.\n이런식으로 Warm Pool을 늘려가면서 최대 <code class=\"language-text\">4 * (15 - 1) = 56</code> 개의 IP를 가질 수 있습니다.\n물론 이 부분은 <code class=\"language-text\">WARM_ENI_TARGET</code> 과 같은 CNI 옵션을 통해 수정할 수 있습니다.</p>\n<br>\n<p><span\n        class=\"gatsby-resp-image-wrapper\"\n        style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\"\n      >\n        <span\n          class=\"gatsby-resp-image-background-image\"\n          style=\"padding-bottom: 21.875%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAJCAAAAABlZTEiAAAAs0lEQVQYGQXBQZIiMQwAMNnpJnDY/78UhiKJvVI0APD+jt1Zo+Y/ACAazjvrfvlbuedrv6Mer/OJms9+t75W1iO+RdTK676crsx0KjL7VOSwW9ARUXxL1D2hEjqgEnRQ6QqexPpsoseEGgB0B4gGqgN+R4u+ER6gg0rRQAeohHOaON0tzdFRKRp6V+RlV8cYvTpzWNV59+q2r77yAueT53FZK/dz1F/UfJ1P1gyr1f3L3/wPvMFx7kXml1AAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n        >\n          <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"eks-ping-pod\"\n        title=\"\"\n        src=\"https://images.ctfassets.net/tushy4jlcik7/18o6b9yBhmnhuavqabdE5m/83bbb51cb99f44cfaa17610ff6e9d5ab/ping_pod.png\"\n        srcset=\"https://images.ctfassets.net/tushy4jlcik7/18o6b9yBhmnhuavqabdE5m/83bbb51cb99f44cfaa17610ff6e9d5ab/ping_pod.png?w=200 200w,\nhttps://images.ctfassets.net/tushy4jlcik7/18o6b9yBhmnhuavqabdE5m/83bbb51cb99f44cfaa17610ff6e9d5ab/ping_pod.png?w=400 400w,\nhttps://images.ctfassets.net/tushy4jlcik7/18o6b9yBhmnhuavqabdE5m/83bbb51cb99f44cfaa17610ff6e9d5ab/ping_pod.png?w=800 800w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n        </span>\n      </span></p>\n<p>구체적으로 CNI를 통해 Pod1 과 Pod2가 어떻게 통신하는지 다이어그램으로 표현하면 위와 같습니다.\n각 Pod의 eth0에는 secondary IP address가 할당되며 Pod Side Route Table를 가지고 있습니다.\n노드의 네트워크 인터페이스까지 도달한 패킷은 EC2-VPC fabric에 의해 포워딩 됩니다.</p>\n<p>따라서 EKS 노드를 결정할 때 ENI 제한 관련 부분도 중요하게 생각하셔야 합니다.\n노드 당 ENI, IP 주소 제한은 <a href=\"https://docs.aws.amazon.com/ko_kr/AWSEC2/latest/UserGuide/using-eni.html\">해당 공식 문서</a>에서 확인하실 수 있습니다.\n물론 CNI를 사용하지 않고 기존의 Calico와 같은 Overlay Network를 사용할 수도 있습니다.\n하지만 이를 사용하게 되면 네트워크까지 관리해야하며 새로운 장애 포인트로 이어질 수 있습니다.</p>\n<p>​<br></p>\n<h2 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<ul>\n<li><a href=\"https://github.com/aws/amazon-vpc-cni-k8s/blob/master/docs/cni-proposal.md\">https://github.com/aws/amazon-vpc-cni-k8s/blob/master/docs/cni-proposal.md</a></li>\n<li><a href=\"https://medium.com/google-cloud/understanding-kubernetes-networking-pods-7117dd28727\">https://medium.com/google-cloud/understanding-kubernetes-networking-pods-7117dd28727</a></li>\n</ul>\n<br>","excerpt":"모든 Kubernetes as a Service가 그렇듯 EKS 역시 빠르게 변화하고 있습니다.\n오늘의 주제는 EKS의 VPC 네트워크 구성과 CNI 플러그인 입니다. AWS VPC  아마 AWS를 production 환경에서 사용하고 있다면 VPC 구성은 이미 잘 이해하고 계시리라 생각합니다.\nVPC 내에 생성한 인스턴스는 eth0이라는 기본 네트워크 인터페이스를 가지게 됩니다.\n그리고 네트워크 인터페이스에 하나 이상의 IPv4 또는 IPv6 주소를 할당할 수 있습니다.\n또한 각 Subnet에 존재하는 인스턴스는 Route Table…"}}}},"pageContext":{"slug":"eks-vpc-cni","basePath":"","prev":{"slug":"eks-autoscale","publishDate":"2019-11-23"},"next":{"slug":"aws-cli-mfa","publishDate":"2019-10-03"}}},"staticQueryHashes":["1946181227","2744905544","3732430097"]}