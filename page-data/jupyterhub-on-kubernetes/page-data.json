{"componentChunkName":"component---src-templates-post-js","path":"/jupyterhub-on-kubernetes/","result":{"data":{"contentfulPost":{"title":"JupyterHub on Kubernetes","slug":"jupyterhub-on-kubernetes","metaDescription":null,"publishDate":"October 23, 2021","publishDateISO":"2021-10-23","tags":[{"title":"DataEngineering","id":"25d7d0d6-3cf7-5e19-a5cb-9c3fa926046f","slug":"dataengineering"}],"heroImage":{"title":"cover-dataengineering","gatsbyImageData":{"images":{"sources":[{"srcSet":"https://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=400&h=267&q=50&fm=webp 400w,\nhttps://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=800&h=533&q=50&fm=webp 800w,\nhttps://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=1600&h=1067&q=50&fm=webp 1600w","sizes":"(min-width: 1600px) 1600px, 100vw","type":"image/webp"}],"fallback":{"src":"https://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=1600&h=1067&fl=progressive&q=50&fm=jpg","srcSet":"https://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=400&h=267&fl=progressive&q=50&fm=jpg 400w,\nhttps://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=800&h=533&fl=progressive&q=50&fm=jpg 800w,\nhttps://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=1600&h=1067&fl=progressive&q=50&fm=jpg 1600w","sizes":"(min-width: 1600px) 1600px, 100vw"}},"layout":"constrained","width":1800,"height":1200,"placeholder":{"fallback":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAlgCWAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBAgb/xAAcEAACAgMBAQAAAAAAAAAAAAAAAQIREiExYeH/xAAWAQEBAQAAAAAAAAAAAAAAAAABAgP/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwDK1DF0vgtxW9EylQu8nTotmo+gHfAEP//Z"}},"ogimg":{"src":"https://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=1800&q=50"}},"body":{"childMarkdownRemark":{"timeToRead":4,"html":"<p>일반적으로 JupyterHub를 Kubernetes 환경에 배포할 때 Helm Chart를 많이 사용합니다.<br>\n이 글에서는 <a href=\"https://github.com/jupyterhub/zero-to-jupyterhub-k8s\">zero-to-jupyterhub-k8s Helm Chart</a>에 포함된 다양한 기능들에 대해 소개해보려 합니다.</p>\n<p><strong>목차</strong></p>\n<ul>\n<li><a href=\"https://swalloow.github.io/jupyterhub-on-kubernetes/#kubespawner\">kubespawner</a></li>\n<li><a href=\"https://swalloow.github.io/jupyterhub-on-kubernetes/#zero-to-jupyterhub-k8s-chart\">zero-to-jupyterhub-k8s chart</a></li>\n<li><a href=\"https://swalloow.github.io/jupyterhub-on-kubernetes/#proxy\">proxy</a></li>\n<li><a href=\"https://swalloow.github.io/jupyterhub-on-kubernetes/#singleuser-profile\">singleuser, profile</a></li>\n<li><a href=\"https://swalloow.github.io/jupyterhub-on-kubernetes/#idle-culler\">idle-culler</a></li>\n<li><a href=\"https://swalloow.github.io/jupyterhub-on-kubernetes/#user-scheduler\">user-scheduler</a></li>\n<li><a href=\"https://swalloow.github.io/jupyterhub-on-kubernetes/#image-pre-puller\">image-pre-puller</a></li>\n<li><a href=\"https://swalloow.github.io/jupyterhub-on-kubernetes/#monitoring\">monitoring</a></li>\n</ul>\n<p><br><br></p>\n<h2 id=\"kubespawner\" style=\"position:relative;\"><a href=\"#kubespawner\" aria-label=\"kubespawner permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KubeSpawner</h2>\n<p><span\n        class=\"gatsby-resp-image-wrapper\"\n        style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\"\n      >\n        <span\n          class=\"gatsby-resp-image-background-image\"\n          style=\"padding-bottom: 51.94274028629857%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/2wBDAQMEBAUEBQkFBQkUDQsNFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBT/wAARCAAVACgDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAQFAwn/xAArEAACAQMEAQIEBwAAAAAAAAABAgMABBEFEiExBhMiFBVBYTJRUnFygYL/xAAXAQEBAQEAAAAAAAAAAAAAAAABAAID/8QAGhEBAAIDAQAAAAAAAAAAAAAAAAERAjFhQf/aAAwDAQACEQMRAD8A9RZbuCBtss0cZ7w7gVzcJfpmGdSoOMxucZ/ywqTXNG03UbWV9RiMsCKXb3uMAA84U/kT1WcLzRbKygjtLq0i9TDobxjIVDICCVZgwyAvGRXVzuLpPLprwaoxTXbyR9+74UTAq+SfZhm4A2/Qg891a+pT6NAZ5red2kGBA78jaCeDvcZPA7H0/rm/jmj3TwatN8NNdRyrMl4S2wOFMYIG7jgle/tXO4tPHPIo7c3zWVw1tI8qenJsUe113EBuRsLd5HJNUdanjR0PyD50Bm3a2YqWMbtllwcc8Y57GCaVL43DpVjLPFp8ENtbCX07d4rgOs52KzbRnsbcH+NKdBvXEEd1BJDKoeKRSjqeiCMEVmt4loroivpVnIEQRqXhViFAwBkjPQFKUV6bmqXpY2yW626wRrAv4Ywo2j9hUdr41pNiSbbTbW2JBGYYVQ4xj6D70pUE2lWsR1bUUa3gItZ0Nu3p++PdCufcSf1N1jgkUpStZbUP/9k='); background-size: cover; display: block;\"\n        >\n          <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"jhub-fluxogram\"\n        title=\"\"\n        src=\"https://images.ctfassets.net/tushy4jlcik7/1g2pkofkAsduRPGEVFH4B5/814e722e99a99dca7afe2b9dc0310f31/jhub-fluxogram.jpeg\"\n        srcset=\"https://images.ctfassets.net/tushy4jlcik7/1g2pkofkAsduRPGEVFH4B5/814e722e99a99dca7afe2b9dc0310f31/jhub-fluxogram.jpeg?w=245 245w,\nhttps://images.ctfassets.net/tushy4jlcik7/1g2pkofkAsduRPGEVFH4B5/814e722e99a99dca7afe2b9dc0310f31/jhub-fluxogram.jpeg?w=489 489w,\nhttps://images.ctfassets.net/tushy4jlcik7/1g2pkofkAsduRPGEVFH4B5/814e722e99a99dca7afe2b9dc0310f31/jhub-fluxogram.jpeg?w=978 978w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n        </span>\n      </span></p>\n<p>먼저 JupyterHub의 기본 아키텍쳐에 대해 간단히 짚고 넘어가보겠습니다.\nJupyterHub에는 노트북 서버를 다양한 방법을 통해 프로비저닝하기 위해 <strong>Spawner</strong>라는 인터페이스가 존재합니다. K8S 환경이라면 KubeSpawner를 사용하게 됩니다. 이를 통해 프로비저닝 단계에서 kube-scheduler 기반으로 다양한 K8S 리소스를 노트북 서버와 함께 사용할 수 있습니다. 또한 KubeSpawner는 <strong>사용자에게 격리된 환경과 컴퓨팅 리소스를 제공</strong>할 수 있습니다.</p>\n<p><strong>노트북 Pod 생성 이벤트</strong><br>\n노트북이 생성되는 과정은 다음과 같습니다.</p>\n<ul>\n<li>할당 가능한 노드 탐색 (NodeSelector, Affinity)</li>\n<li>없으면 CA에 의해 노드 추가, 노드가 Ready 상태가 될 때까지 대기</li>\n<li>Pod을 추가된 노드에 할당</li>\n<li>노트북 이미지 pull</li>\n<li>노트북 컨테이너 실행</li>\n</ul>\n<br>\n<h2 id=\"zero-to-jupyterhub-k8s-chart\" style=\"position:relative;\"><a href=\"#zero-to-jupyterhub-k8s-chart\" aria-label=\"zero to jupyterhub k8s chart permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>zero-to-jupyterhub-k8s Chart</h2>\n<p><span\n        class=\"gatsby-resp-image-wrapper\"\n        style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\"\n      >\n        <span\n          class=\"gatsby-resp-image-background-image\"\n          style=\"padding-bottom: 58.467741935483865%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n        >\n          <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"jupyter-arch\"\n        title=\"\"\n        src=\"https://images.ctfassets.net/tushy4jlcik7/4MoN7kIqTpEHdcjmdL5Y6u/fff4757c2dec3620e147654578a3be6f/jupyter-arch.png\"\n        srcset=\"https://images.ctfassets.net/tushy4jlcik7/4MoN7kIqTpEHdcjmdL5Y6u/fff4757c2dec3620e147654578a3be6f/jupyter-arch.png?w=496 496w,\nhttps://images.ctfassets.net/tushy4jlcik7/4MoN7kIqTpEHdcjmdL5Y6u/fff4757c2dec3620e147654578a3be6f/jupyter-arch.png?w=992 992w,\nhttps://images.ctfassets.net/tushy4jlcik7/4MoN7kIqTpEHdcjmdL5Y6u/fff4757c2dec3620e147654578a3be6f/jupyter-arch.png?w=1984 1984w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n        </span>\n      </span></p>\n<p><a href=\"https://github.com/jupyterhub/zero-to-jupyterhub-k8s\">zero-to-jupyterhub-k8s Helm Chart</a> 의 아키텍쳐는 위의 그림과 같습니다. 기존 JupyterHub와 달리 hook-image-awaiter, jupyterhub-idle-culler 등의 컴포넌트가 추가된 모습을 확인하실 수 있습니다. 이제 대략적으로 어떤 기능을 제공하는지 알아보겠습니다.</p>\n<br>\n<h2 id=\"proxy\" style=\"position:relative;\"><a href=\"#proxy\" aria-label=\"proxy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Proxy</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">proxy</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> ClusterIP\n  <span class=\"token key atrule\">chp</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">networkPolicy</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></code></pre></div>\n<p>먼저 CHP(configurable-http-proxy) 설정 부분입니다. JupyterHub에서 <strong>Proxy는 인증, 사용자 노트북 라우팅, 헬스 체크 등 다양한 역할을 수행</strong>합니다. 차트에서는 유연한 Proxy 설정을 위해 CHP, Traefik 등 다양한 옵션을 지원합니다. 아키텍쳐는 aws-load-balancer-controller를 사용한다는 가정하에 구성한 예시입니다. 위 그림과 같이 사용자는 중간의 Proxy 컴포넌트를 거쳐 JupyterHub에 접속하게 됩니다.</p>\n<br>\n<h2 id=\"singleuser-profile\" style=\"position:relative;\"><a href=\"#singleuser-profile\" aria-label=\"singleuser profile permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>SingleUser, Profile</h2>\n<p><span\n        class=\"gatsby-resp-image-wrapper\"\n        style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\"\n      >\n        <span\n          class=\"gatsby-resp-image-background-image\"\n          style=\"padding-bottom: 34.9112426035503%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n        >\n          <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"spawner-op\"\n        title=\"\"\n        src=\"https://images.ctfassets.net/tushy4jlcik7/4Jrhk4lMCRaiiE5mF8cbXX/7162ec3e96318c1ba6fb018d01008b53/spawner-op.png\"\n        srcset=\"https://images.ctfassets.net/tushy4jlcik7/4Jrhk4lMCRaiiE5mF8cbXX/7162ec3e96318c1ba6fb018d01008b53/spawner-op.png?w=676 676w,\nhttps://images.ctfassets.net/tushy4jlcik7/4Jrhk4lMCRaiiE5mF8cbXX/7162ec3e96318c1ba6fb018d01008b53/spawner-op.png?w=1352 1352w,\nhttps://images.ctfassets.net/tushy4jlcik7/4Jrhk4lMCRaiiE5mF8cbXX/7162ec3e96318c1ba6fb018d01008b53/spawner-op.png?w=2704 2704w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n        </span>\n      </span></p>\n<p>singleUser는 사용자의 노트북 환경을 의미하며 사용자는 미리 정의된 프로필(이미지)을 선택하여 원하는 노트북 환경을 생성할 수 있습니다. 위 아키텍쳐에서는 <strong>PV, PVC를 통해 사용자에게 개인, 공용 볼륨을 할당</strong>해주었습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">profileList</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">display_name</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Python Notebook\"</span>\n    <span class=\"token key atrule\">description</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"Spec: CPU 2, Memory 4G / Spark 3.1\"</span>\n    <span class=\"token key atrule\">kubespawner_override</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> jupyter/python<span class=\"token punctuation\">-</span>notebook<span class=\"token punctuation\">:</span>hub<span class=\"token punctuation\">-</span>1.4.2\n      <span class=\"token key atrule\">cpu_limit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span>\n      <span class=\"token key atrule\">mem_limit</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"4G\"</span>\n      <span class=\"token key atrule\">cpu_guarantee</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span>\n      <span class=\"token key atrule\">mem_guarantee</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2G\"</span>\n      <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">TZ</span><span class=\"token punctuation\">:</span> Asia/Seoul\n      <span class=\"token key atrule\">lifecycle_hooks</span><span class=\"token punctuation\">:</span>\n        <span class=\"token key atrule\">postStart</span><span class=\"token punctuation\">:</span>\n          <span class=\"token key atrule\">exec</span><span class=\"token punctuation\">:</span>\n            command<span class=\"token punctuation\">:</span></code></pre></div>\n<p>프로필에는 리소스 뿐만 아니라 lifecycle_hook, environment 등 K8S의 다양한 리소스를 함께 정의하여 유연하게 구성할 수 있습니다. 노트북 기본 이미지는 <a href=\"https://github.com/jupyter/docker-stacks\">jupyter/docker-stacks</a> 저장소로부터 생성한다면 편하게 패키지 의존성을 관리할 수 있습니다.</p>\n<p><strong>resource guarantee</strong><br>\nresource guarantee는 모든 사용자가 최소한 <code class=\"language-text\">_guarantee</code> 만큼의 리소스를 사용할 수 있으며 최대 <code class=\"language-text\">_limit</code> 만큼의 리소스를 제공받을 수 있음을 의미합니다. 예를 들어 사용자에게 2G의 RAM이 보장되는 경우, 사용자는 2G 이상의 RAM을 사용할 수 있습니다. 문서에서는 guarantee 값을 limit의 반으로 설정하는 것을 권장하고 있습니다.</p>\n<br>\n<h2 id=\"idle-culler\" style=\"position:relative;\"><a href=\"#idle-culler\" aria-label=\"idle culler permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Idle Culler</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">cull</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n  <span class=\"token key atrule\">timeout</span><span class=\"token punctuation\">:</span> <span class=\"token number\">86400</span>\n  <span class=\"token key atrule\">every</span><span class=\"token punctuation\">:</span> <span class=\"token number\">600</span>\n  <span class=\"token key atrule\">concurrency</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span></code></pre></div>\n<p>idle-culler는 일정 주기 동안 미사용된 노트북 리소스를 정리합니다.\n이를 통해 노트북 리소스를 최적화하여 운영할 수 있습니다.\nidle-culler를 활성화하면 JupyterHub Service에 등록되며 이후 JupyterHub API를 통해 사용자 활동을 주기적으로 확인합니다.</p>\n<br>\n<h2 id=\"user-scheduler\" style=\"position:relative;\"><a href=\"#user-scheduler\" aria-label=\"user scheduler permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>User Scheduler</h2>\n<p>user scheduler는 노트북 리소스를 적절한 노드에 할당하기 위해 추가되었습니다.\n기본 K8S 스케줄러는 여러 노드에 분산하여 리소스를 할당하지만, user scheduler는 가장 리소스를 많이 점유하고 있는 노드에 리소스를 할당합니다. 이를 통해 <strong>Cluster AutoScaler, idle-culler와 연계하여 노트북 리소스를 최적화하여 운영</strong>할 수 있습니다.</p>\n<p><span\n        class=\"gatsby-resp-image-wrapper\"\n        style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\"\n      >\n        <span\n          class=\"gatsby-resp-image-background-image\"\n          style=\"padding-bottom: 51.3405362144858%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAVCAIAAAC7eDtJAAAACXBIWXMAABcRAAAXEQHKJvM/AAAAB3RJTUUH6AEUCC02NVtE+QAAAxJJREFUGBm9wVGPE2UYhuH7eb9vZtru0i5IIjEmGMO5Rxr//+/w2ANNhLC77XZmvvexC2wFpAVi4nXp519+BU3TdLu9xZ+B38CfhP/xaL2utbZ57vvBNmDcMQm/3uXrJ9/rhx9fhLS/ebXcPN2+/KOVgf9F7Uo8GgaWz4D1t9/xMUk2YD6yXK2A3XbHPXOOwByJ691dnae2HMRpRUpj/mW7A5aAhDlHwhwJrltWO81JAmOMESfINufINu8IsIGKdL0fOa0UMm2LEyRsEJhPkrA5KrXMmRV02xqnVcikrq88z93Qh3J3c7daX7Rxn92q7bal721HqTmN436Ws/ouLjY1aK2ZwJkEbY4Sme4vF4z7ms4gOM2wWmhzVUu3wG7J1aK5L86FirwaStfZbrHw3Ds65l3etGHTgUQSVU6jnPbqBjmNrvuu2uY8IzDMU1PIZlZfDAq3zP7SCrc5qer7nKZS+1aWKnVqEZ6YmyKCTEstXQeIdNSI4CwJCRDgNKB+RbsDrEj1kaNVhWyiFKt2jzZTQoQTZCucswoH7i6YR0PFfJbEkRWOjnbn6KyQExUU2LI5sCm9bQ6UCAiHIhPbc5OKcLXNh8pBME6t62qaIq9Wg7EQkGVlZJTRWwUbhTN5j8CAjQoIhVWtGvOtsWxM7YsQtaqvGvrh+TdXYymXy4s23imi1P52mne3L28RYBVHlTPrChWQBFgSHxIggbhncWCiEyAOqkr56cXzv3Y3j6822o+1W1SUral0QGttVSmXj+/2Y5v3rkvZHETFFubLqbTayckbYVP7/tnmSZdRuwX3zPtMLy67Qf36aV+6MAc2X09OHlQfZDZOE4Z15ap4hil4lbY5kmSb0yTZ5oG4VwFJnOMI2TQkuAhvQ2PyPkmcJYkjGQhJfI0qrQt9IP6TypcQmKOLUJEn2CdpJNI081ZLks+r6bTNGcIHyDYPBljAKmggSEjumXt7e2wcNTQ280Dcqyh++/1PFJi0JQTOpqiInOfaFVtTyyIB2+2Wt4QQYCwJY8yBMe9IQtgGAbYlMONu9zdh2RHOof4F1AAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n        >\n          <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"user-scheduler\"\n        title=\"\"\n        src=\"https://images.ctfassets.net/tushy4jlcik7/3qNbciBgdcZkpDehv68qg6/0f8ed9b319612f669c17f2dbd359ff2e/user-scheduler.png\"\n        srcset=\"https://images.ctfassets.net/tushy4jlcik7/3qNbciBgdcZkpDehv68qg6/0f8ed9b319612f669c17f2dbd359ff2e/user-scheduler.png?w=625 625w,\nhttps://images.ctfassets.net/tushy4jlcik7/3qNbciBgdcZkpDehv68qg6/0f8ed9b319612f669c17f2dbd359ff2e/user-scheduler.png?w=1250 1250w,\nhttps://images.ctfassets.net/tushy4jlcik7/3qNbciBgdcZkpDehv68qg6/0f8ed9b319612f669c17f2dbd359ff2e/user-scheduler.png?w=2499 2499w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n        </span>\n      </span></p>\n<p>예를 들어 일반적인 설정이라면, pod가 다양한 노드에 분산되어 클러스터 scale-in 조건까지 도달하기가 어렵습니다. 하지만 user-scheduler를 사용한다면, 위 그림과 같이 노드에 할당된 pod의 수가 점진적으로 줄어들게 됩니다.</p>\n<br>\n<h2 id=\"image-pre-puller\" style=\"position:relative;\"><a href=\"#image-pre-puller\" aria-label=\"image pre puller permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Image Pre Puller</h2>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">prePuller</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span>\n      <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 10m\n      <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 8Mi\n  <span class=\"token key atrule\">hook</span><span class=\"token punctuation\">:</span>\n    <span class=\"token key atrule\">enabled</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span>\n    <span class=\"token key atrule\">pullOnlyOnChanges</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></code></pre></div>\n<p>Image prePuller는 사용자가 노트북을 실행하기 전에 노드에 미리 이미지를 준비하여 노트북 환경 생성 시간을 단축시켜 줍니다. 예를 들어 CA에 의해 노드가 새로 추가된다거나 새로운 이미지가 프로필에 등록된 경우, 미리 노드에 프로필 이미지를 pull 하게 됩니다.</p>\n<br>\n<h2 id=\"monitoring\" style=\"position:relative;\"><a href=\"#monitoring\" aria-label=\"monitoring permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Monitoring</h2>\n<p>JupyterHub는 <code class=\"language-text\">/metrics</code> endpoint를 통해 prometheus 메트릭을 지원합니다. 주요 지표로는 활성 사용자 수, 노트북 서버 생성까지 소요되는 시간 등이 있습니다. 사용 가능한 전체 메트릭은 <a href=\"https://jupyterhub.readthedocs.io/en/stable/reference/metrics.html\">JupyterHub 문서</a>에서 확인하실 수 있습니다.\n또한  <a href=\"https://github.com/jupyterhub/grafana-dashboards\">jupyterhub/grafana-dashboards</a> 저장소를 통해 미리 정의된 운영 대시보드를 제공합니다. 이를 통해 쉽게 모니터링을 구성할 수 있습니다.</p>\n<br>\n<h2 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<ul>\n<li><a href=\"https://zero-to-jupyterhub.readthedocs.io/en/latest/index.html\">https://zero-to-jupyterhub.readthedocs.io/en/latest/index.html</a></li>\n<li><a href=\"https://jupyterhub.readthedocs.io/en/stable/index.html\">https://jupyterhub.readthedocs.io/en/stable/index.html</a></li>\n</ul>","excerpt":"일반적으로 JupyterHub를 Kubernetes 환경에 배포할 때 Helm Chart를 많이 사용합니다.\n이 글에서는 zero-to-jupyterhub-k8s Helm Chart에 포함된 다양한 기능들에 대해 소개해보려 합니다. 목차 kubespawner zero-to-jupyterhub-k8s chart proxy singleuser, profile idle-culler user-scheduler image-pre-puller monitoring  KubeSpawner  먼저 JupyterHub…"}}}},"pageContext":{"slug":"jupyterhub-on-kubernetes","basePath":"","prev":{"slug":"jupyterhub-tensorboard","publishDate":"2021-10-23"},"next":{"slug":"data-mesh-principle","publishDate":"2021-09-25"}}},"staticQueryHashes":["1946181227","2744905544","3732430097"]}