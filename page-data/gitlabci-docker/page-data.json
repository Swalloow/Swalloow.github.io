{"componentChunkName":"component---src-templates-post-js","path":"/gitlabci-docker/","result":{"data":{"contentfulPost":{"id":"621294a0-8d52-55c7-8faf-4ec046187c06","title":"Docker와 Gitlab CI를 활용한 빌드, 테스트 자동화","slug":"gitlabci-docker","metaDescription":null,"publishDate":"March 31, 2017","publishDateISO":"2017-03-31","tags":[{"title":"DevOps","id":"701ee587-d6e3-5391-af93-e295765b6f45","slug":"devops"}],"heroImage":{"id":"f36c235f-3e3e-517d-bd80-697bc6183072","title":"cover-devops","fluid":{"aspectRatio":1.5,"src":"//images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=1800&q=50","srcSet":"//images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=450&h=300&q=50 450w,\n//images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=900&h=600&q=50 900w,\n//images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=1080&h=720&q=50 1080w","srcWebp":"//images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=1800&q=50&fm=webp","srcSetWebp":"//images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=450&h=300&q=50&fm=webp 450w,\n//images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=900&h=600&q=50&fm=webp 900w,\n//images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=1080&h=720&q=50&fm=webp 1080w","sizes":"(max-width: 1800px) 100vw, 1800px"},"ogimg":{"src":"//images.ctfassets.net/tushy4jlcik7/7KaSTt3mdmrYq2ZK1RiJku/dafd981ff3686217ac151b562e8b1412/cover_devops.jpg?w=1800&fl=progressive&q=50"}},"body":{"id":"8113e868-69c3-58fb-8823-a90d89e5d7aa","childMarkdownRemark":{"id":"89ad52b7-f054-5de5-ba3f-e321a1e1ff2f","timeToRead":2,"html":"<p>Gitlab은 설치형 GitHub이라고 이해하시면 편합니다.\n무료로 private repository와 CI 서버를 제공해줍니다.\n심지어 Docker Registry도 무료로 제공하고 있습니다.\n아직 많은 분들이 Gitlab CI의 여러 장점들을 잘 모르시는 것 같아 정리해보았습니다.</p>\n<br>\n<h2 id=\"gitlab-ci\" style=\"position:relative;\"><a href=\"#gitlab-ci\" aria-label=\"gitlab ci permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gitlab CI</h2>\n<p>Gitlab CI는 Gitlab에서 무료로 제공하는 CI 툴 입니다.\nGitlab과 완벽하게 연동되며 CI를 위해 <strong>CI linter, pipeline, cycle analytics</strong> 등 다양한 서비스를 제공합니다.</p>\n<p><img src=\"/assets/images/gitlab-ci.png\" alt=\"Gitlab-CI\"></p>\n<p>travis, circle CI와 마찬가지로 Gitlab CI는 <code class=\"language-text\">gitlab-ci.yml</code> 파일로 설정할 수 있습니다.\nGitlab은 DigitalOcean과 제휴하여 CI 서버(Runner)를 따로 제공합니다.\n따라서 <code class=\"language-text\">Runner</code>에 job을 할당하여 돌아가도록 설정할 수 있습니다.</p>\n<p><img src=\"/assets/images/gitlab-pipe.png\" alt=\"Gitlab-Pipe\"></p>\n<p>그리고 Runner는 <strong>Docker 컨테이너</strong> 를 기반으로 돌아갑니다.\nGitlab CI를 실행해보면 처음에 Ruby 이미지를 받아와서 컨테이너를 실행시키는 것을 볼 수 있습니다.\n따라서, <strong>Base Image를 내 어플리케이션 이미지로 바꾸면 빌드 및 테스트 속도가 빠르게 향상됩니다</strong>.</p>\n<br>\n<h2 id=\"gitlab-registry\" style=\"position:relative;\"><a href=\"#gitlab-registry\" aria-label=\"gitlab registry permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Gitlab Registry</h2>\n<p><img src=\"/assets/images/gitlab-registry.png\" alt=\"Gitlab-Registry\"></p>\n<p>Docker 친화적인 Gitlab은 Docker Registry도 무료로 제공해줍니다.\n<code class=\"language-text\">Gitlab Registry</code> 탭에 들어가면 Docker Registry의 주소가 적혀있고 친절하게 명령어까지 써있습니다.</p>\n<p>아마 많은 분들이 DockerHub를 결제하거나, AWS S3를 이용하여 Docker Registry를 구축하셨을 겁니다. 하지만 Gitlab에서는 그럴 필요가 없습니다.</p>\n<br>\n<h2 id=\"docker-with-gitlab-ci\" style=\"position:relative;\"><a href=\"#docker-with-gitlab-ci\" aria-label=\"docker with gitlab ci permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Docker with Gitlab CI</h2>\n<p>gitlab-ci 설정파일은 대략 다음과 같습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"yaml\"><pre class=\"language-yaml\"><code class=\"language-yaml\"><span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> gitlab<span class=\"token punctuation\">-</span>registry\n<span class=\"token key atrule\">stages</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> build\n  <span class=\"token punctuation\">-</span> test\n  <span class=\"token punctuation\">-</span> deploy\n\n<span class=\"token key atrule\">job-build</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> build\n  <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> pip install <span class=\"token punctuation\">-</span>r requirements.txt\n  <span class=\"token punctuation\">-</span> python <span class=\"token punctuation\">-</span>m py_compile run.py\n\n<span class=\"token key atrule\">job-test</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> test\n  <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> pytest <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>pep8 <span class=\"token punctuation\">-</span>m pep8 backend/\n\n<span class=\"token key atrule\">job-deploy</span><span class=\"token punctuation\">:</span>\n  <span class=\"token key atrule\">stage</span><span class=\"token punctuation\">:</span> deploy\n  <span class=\"token key atrule\">script</span><span class=\"token punctuation\">:</span>\n  <span class=\"token punctuation\">-</span> deployment</code></pre></div>\n<p>Gitlab CI와 Docker를 활용한 빌드 테스트 자동화는 위의 그림과 같이 이루어집니다.</p>\n<p><img src=\"/assets/images/ci-process.png\" alt=\"CI\"></p>\n<ol>\n<li>사용자가 Gitlab 저장소에 push를 하면, Gitlab CI Runner로 전달됩니다.</li>\n<li>Gitlab CI는 Gitlab Registry로부터 Docker 이미지를 받아옵니다. Docker 이미지에는 어플리케이션 환경이 설정되어 있습니다.</li>\n<li>Docker 컨테이너가 실행되면 첫번째 job에 정의된 대로 필요한 패키지를 설치하고 빌드를 수행합니다.</li>\n<li>빌드가 통과되면 두번째 job에 정의된 대로 테스트를 수행합니다.</li>\n<li>테스트가 통과되면 세번째 job에 정의된 대로 배포 과정을 수행합니다.</li>\n<li>각 과정은 모두 Slack 알림으로 확인할 수 있습니다.</li>\n</ol>\n<br>\n<p><img src=\"/assets/images/gitlab-pipeline.png\" alt=\"Gitlab\"></p>\n<p>위와 같이 모든 과정을 <code class=\"language-text\">Gitlab Pipeline</code>을 통해 확인하실 수 있습니다.</p>\n<p>Gitlab의 단점이라면 Community 버전의 서버가 조금 불안정하다는 점입니다.\n물론 설치형 Gitlab을 사용하신다면 이런 단점마저 존재하지 않습니다.\n소규모의 팀이라면 충분히 도입을 검토해볼만 하다고 생각합니다.</p>\n<br>","excerpt":"Gitlab은 설치형 GitHub이라고 이해하시면 편합니다.\n무료로 private repository와 CI 서버를 제공해줍니다.\n심지어 Docker Registry도 무료로 제공하고 있습니다.\n아직 많은 분들이 Gitlab CI의 여러 장점들을 잘 모르시는 것 같아 정리해보았습니다. Gitlab CI Gitlab CI는 Gitlab에서 무료로 제공하는 CI 툴 입니다.\nGitlab과 완벽하게 연동되며 CI를 위해 CI linter, pipeline, cycle analytics 등 다양한 서비스를 제공합니다. Gitlab-CI travis, circle CI…"}}}},"pageContext":{"slug":"gitlabci-docker","basePath":"","prev":{"slug":"influx-grafana1","publishDate":"2017-04-05"},"next":{"slug":"dockerfile-ignore","publishDate":"2017-03-28"}}}}