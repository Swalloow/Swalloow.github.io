{"componentChunkName":"component---src-templates-post-js","path":"/eks-kubeflow/","result":{"data":{"contentfulPost":{"title":"Amazon EKS에 Kubeflow 구축하기","slug":"eks-kubeflow","metaDescription":null,"publishDate":"March 10, 2019","publishDateISO":"2019-03-10","tags":[{"title":"DataEngineering","id":"25d7d0d6-3cf7-5e19-a5cb-9c3fa926046f","slug":"dataengineering"}],"heroImage":{"title":"cover-dataengineering","gatsbyImageData":{"images":{"sources":[{"srcSet":"https://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=400&h=267&q=50&fm=webp 400w,\nhttps://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=800&h=533&q=50&fm=webp 800w,\nhttps://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=1600&h=1067&q=50&fm=webp 1600w","sizes":"(min-width: 1600px) 1600px, 100vw","type":"image/webp"}],"fallback":{"src":"https://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=1600&h=1067&fl=progressive&q=50&fm=jpg","srcSet":"https://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=400&h=267&fl=progressive&q=50&fm=jpg 400w,\nhttps://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=800&h=533&fl=progressive&q=50&fm=jpg 800w,\nhttps://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=1600&h=1067&fl=progressive&q=50&fm=jpg 1600w","sizes":"(min-width: 1600px) 1600px, 100vw"}},"layout":"constrained","width":1800,"height":1200,"placeholder":{"fallback":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAlgCWAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBAgb/xAAcEAACAgMBAQAAAAAAAAAAAAAAAQIREiExYeH/xAAWAQEBAQAAAAAAAAAAAAAAAAABAgP/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwDK1DF0vgtxW9EylQu8nTotmo+gHfAEP//Z"}},"ogimg":{"src":"https://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=1800&q=50"}},"body":{"childMarkdownRemark":{"timeToRead":3,"html":"<p>AWS EKS는 Fully managed K8S 서비스 입니다. 이번 글에서는 EKS 환경에 Kubeflow를 구축하는 방법에 대해 정리해보겠습니다.</p>\n<ul>\n<li><a href=\"http://swalloow.github.io/why-kubeflow\">Why kubeflow in your Infrastructure</a></li>\n<li><a href=\"http://swalloow.github.io/eks-kubeflow\">Amazon EKS에 Kubeflow 구축하기</a></li>\n<li>Kubeflow의 ModelDB</li>\n<li>Kubeflow의 Hyper parameter Tuning (Katib)</li>\n</ul>\n<br>\n<h2 id=\"기본-환경-설치\" style=\"position:relative;\"><a href=\"#%EA%B8%B0%EB%B3%B8-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%B9%98\" aria-label=\"기본 환경 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>기본 환경 설치</h2>\n<p>Kubeflow를 설치하기 이전에 AWS CLI, Docker가 설치되어 있어야 합니다.\nEKS에서는 최근에 GPU 인스턴스인 P2, P3에 대한 지원을 제공하고 있습니다.\n이를 사용하기 위해 AWS Marketplace에서 <a href=\"https://aws.amazon.com/marketplace/pp/B07GRHFXGM\">EKS-optimized AMI with GPU Support</a>를 구독해주어야 합니다.</p>\n<p>EKS는 Web UI 또는 eksctl이라는 cli 도구를 사용해서 클러스터를 구성할 수 있습니다.\neksctl은 kubectl이나 kops와 유사한 명령어를 제공합니다.\n자세한 내용은 <a href=\"https://aws.amazon.com/ko/blogs/opensource/eksctl-eks-cluster-one-command/\">https://aws.amazon.com/ko/blogs/opensource/eksctl-eks-cluster-one-command/</a> 에서 참고하시면 됩니다.</p>\n<br>\n<h2 id=\"eks-클러스터-생성\" style=\"position:relative;\"><a href=\"#eks-%ED%81%B4%EB%9F%AC%EC%8A%A4%ED%84%B0-%EC%83%9D%EC%84%B1\" aria-label=\"eks 클러스터 생성 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>EKS 클러스터 생성</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># install eksctl</span>\n$ brew tap weaveworks/tap\n$ brew <span class=\"token function\">install</span> weaveworks/tap/eksctl\n\n<span class=\"token comment\"># create cluster</span>\n$ eksctl create cluster eks-cpu <span class=\"token punctuation\">\\</span>\n--node-type<span class=\"token operator\">=</span>c4.xlarge <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--timeout</span><span class=\"token operator\">=</span>40m <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--nodes</span><span class=\"token operator\">=</span><span class=\"token number\">2</span> <span class=\"token punctuation\">\\</span>\n<span class=\"token parameter variable\">--region</span><span class=\"token operator\">=</span>ap-northeast-2\n\n<span class=\"token comment\"># NVIDIA driver plugin</span>\nkubectl apply <span class=\"token parameter variable\">-f</span> https://raw.githubusercontent.com/NVIDIA/k8s-device-plugin/v1.11/nvidia-device-plugin.yml\nkubectl get nodes <span class=\"token string\">\"-o=custom-columns=NAME:.metadata.name,MEMORY:.status.allocatable.memory,CPU:.status.allocatable.cpu,GPU:.status.allocatable.nvidia\\.com/gpu\"</span></code></pre></div>\n<ul>\n<li>먼저 Homebrew로 <code class=\"language-text\">eksctl</code>을 설치합니다. 이후 아래의 명령어를 통해 c4 인스턴스 기반의 EKS 클러스터를 생성하고 Memory, CPU, GPU 정보를 확인해줍니다.</li>\n<li>GPU 인스턴스로 클러스터를 생성하고 싶다면 생성하기 이전에 EC2 Limit 페이지에서 p2 또는 p3 인스턴스의 limit을 확인해야 합니다. 0으로 되어있다면 <code class=\"language-text\">Request limit Increase</code>가 필요합니다.</li>\n<li>GPU-enabled worker를 가지는 EKS 클러스터를 생성한다면 NVIDIA driver plugin을 활성화시키는 과정이 필요합니다.</li>\n<li>Create cluster에서 <code class=\"language-text\">AccessDenied</code> 오류가 발생하는 경우, 사용할 IAM 유저를 생성하고 EKS 관련 permission과 <code class=\"language-text\">AWSCloudFormationReadOnlyAccess</code>를 추가해주어야 합니다. EKS는 현재 기준 1.11 버전을 default로 사용하고 있습니다.</li>\n</ul>\n<p><img src=\"http://drive.google.com/uc?export=view&#x26;id=1y10f8hW0KFZGSn7WLFne_aqUV4YjPQqJ\" alt=\"eks\"></p>\n<p>EKS 메뉴에 가보시면 EC2 인스턴스, 네트워크 설정이 완료된 것을 확인하실 수 있습니다.\nAWS CloudFormation에서 cluster와 node-group에 대한 stack이 생성됩니다.</p>\n<p>K8S 대시보드는 <a href=\"https://docs.aws.amazon.com/ko_kr/eks/latest/userguide/dashboard-tutorial.html\">AWS EKS 공식 문서</a>를 참고하여 띄울 수 있습니다.</p>\n<br>\n<h2 id=\"ksonnet을-이용한-kubeflow-설치\" style=\"position:relative;\"><a href=\"#ksonnet%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-kubeflow-%EC%84%A4%EC%B9%98\" aria-label=\"ksonnet을 이용한 kubeflow 설치 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>ksonnet을 이용한 KubeFlow 설치</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token comment\"># install ksonnet</span>\n$ brew <span class=\"token function\">install</span> ksonnet/tap/ks\n$ ks version\nksonnet version: <span class=\"token number\">0.13</span>.1\njsonnet version: v0.11.2\nclient-go version: kubernetes-1.10.4\n\n<span class=\"token comment\"># install kubeflow</span>\n$ <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">KUBEFLOW_TAG</span><span class=\"token operator\">=</span>v0.4.1\n$ <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">KUBEFLOW_SRC</span><span class=\"token operator\">=</span>/tmp/kubeflow_src\n$ <span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">KFAPP</span><span class=\"token operator\">=</span>eks-kubeflow\n\n$ <span class=\"token function\">mkdir</span> <span class=\"token variable\">${KUBEFLOW_SRC}</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token builtin class-name\">cd</span> <span class=\"token variable\">${KUBEFLOW_SRC}</span>\n$ <span class=\"token function\">curl</span> https://raw.githubusercontent.com/kubeflow/kubeflow/<span class=\"token variable\">${KUBEFLOW_TAG}</span>/scripts/download.sh <span class=\"token operator\">|</span> <span class=\"token function\">bash</span>\n\n$ <span class=\"token function\">sh</span> <span class=\"token variable\">${KUBEFLOW_SRC}</span>/scripts/kfctl.sh init <span class=\"token variable\">${KFAPP}</span> <span class=\"token parameter variable\">--platform</span> none\n$ <span class=\"token builtin class-name\">cd</span> <span class=\"token variable\">${KFAPP}</span>\n$ <span class=\"token function\">sh</span> <span class=\"token variable\">${KUBEFLOW_SRC}</span>/scripts/kfctl.sh generate k8s\n$ <span class=\"token function\">sh</span> <span class=\"token variable\">${KUBEFLOW_SRC}</span>/scripts/kfctl.sh apply k8s</code></pre></div>\n<p>ksonnet으로 KubeFlow를 설치하기 이전에 먼저 Homebrew로 ksonnet을 설치합니다.</p>\n<br>\n<h2 id=\"kubeflow\" style=\"position:relative;\"><a href=\"#kubeflow\" aria-label=\"kubeflow permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>KubeFlow</h2>\n<p><img src=\"http://drive.google.com/uc?export=view&#x26;id=1W9rnEB-Bn5IZjLOymYXNxMPNclyY4eJn\" alt=\"kubeflow-pods\">\n<img src=\"http://drive.google.com/uc?export=view&#x26;id=15IWqbbib_vhB_k4FlUK_K39ERUbkVHr0\" alt=\"kubeflow-pvc\"></p>\n<p>KubeFlow를 설치하고 나면 Pods, Deployment, Service, ConfigMap 등 모든 컴포넌트들이 자동으로 배포됩니다. default로 PVC는 EBS gp2 볼륨이 설정된 것을 확인하실 수 있습니다.</p>\n<p>EKS에서는 IAM 기반의 RBAC 인증을 사용합니다.\n아래의 명령어를 통해 EKS의 JupyterHub를 로컬의 8080 포트로 포워딩해서 접속하실 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ kubectl port-forward svc/jupyter-lb <span class=\"token parameter variable\">-n</span> kubeflow <span class=\"token number\">8080</span>:80</code></pre></div>\n<p><img src=\"http://drive.google.com/uc?export=view&#x26;id=1XNiADQX6faiejXKz3OlpwYMhqZQ6xPoz\" alt=\"kubeflow-jupyterhub\"></p>\n<p>위와 같이 설치하고 난 이후에 KubeFlow 문서의 git summerization 튜토리얼을 그대로 따라하실 수 있습니다. 모든 컴포넌트가 자동으로 배포되다 보니 생략하고 넘어가는 경우가 많은데 production 환경에서 사용하려면 각 설정 YAML 파일을 내 환경에 맞도록 수정할 필요가 있습니다. 삭제는 아래의 명령어를 통해 실행시키면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token builtin class-name\">cd</span> <span class=\"token variable\">${KUBEFLOW_SRC}</span>/<span class=\"token variable\">${KFAPP}</span>\n$ <span class=\"token function\">sh</span> <span class=\"token variable\">${KUBEFLOW_SRC}</span>/scripts/kfctl.sh delete k8s</code></pre></div>\n<br>\n<h2 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<ul>\n<li><a href=\"https://aws.amazon.com/ko/blogs/opensource/kubeflow-amazon-eks/\">https://aws.amazon.com/ko/blogs/opensource/kubeflow-amazon-eks/</a></li>\n<li><a href=\"https://github.com/aws-samples/machine-learning-using-k8s/blob/master/kubeflow.md\">https://github.com/aws-samples/machine-learning-using-k8s/blob/master/kubeflow.md</a></li>\n<li><a href=\"https://eksctl.io/\">https://eksctl.io/</a></li>\n</ul>\n<br>","excerpt":"AWS EKS는 Fully managed K8S 서비스 입니다. 이번 글에서는 EKS 환경에 Kubeflow를 구축하는 방법에 대해 정리해보겠습니다. Why kubeflow in your Infrastructure Amazon EKS에 Kubeflow 구축하기 Kubeflow의 ModelDB Kubeflow의 Hyper parameter Tuning (Katib) 기본 환경 설치 Kubeflow를 설치하기 이전에 AWS CLI, Docker가 설치되어 있어야 합니다.\nEKS에서는 최근에 GPU 인스턴스인 P2, P…"}}}},"pageContext":{"slug":"eks-kubeflow","basePath":"","prev":{"slug":"container-patterns2","publishDate":"2019-03-23"},"next":{"slug":"why-kubeflow","publishDate":"2019-03-09"}}},"staticQueryHashes":["1946181227","2744905544","3732430097"]}