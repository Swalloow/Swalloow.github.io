{"componentChunkName":"component---src-templates-post-js","path":"/container-tini-dumb-init/","result":{"data":{"contentfulPost":{"title":"컨테이너 환경을 위한 초기화 시스템 (tini, dumb-init)","slug":"container-tini-dumb-init","metaDescription":null,"publishDate":"May 27, 2022","publishDateISO":"2022-05-27","tags":[{"title":"DataEngineering","id":"25d7d0d6-3cf7-5e19-a5cb-9c3fa926046f","slug":"dataengineering"}],"heroImage":{"title":"cover-dataengineering","gatsbyImageData":{"images":{"sources":[{"srcSet":"https://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=400&h=267&q=50&fm=webp 400w,\nhttps://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=800&h=533&q=50&fm=webp 800w,\nhttps://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=1600&h=1067&q=50&fm=webp 1600w","sizes":"(min-width: 1600px) 1600px, 100vw","type":"image/webp"}],"fallback":{"src":"https://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=1600&h=1067&fl=progressive&q=50&fm=jpg","srcSet":"https://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=400&h=267&fl=progressive&q=50&fm=jpg 400w,\nhttps://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=800&h=533&fl=progressive&q=50&fm=jpg 800w,\nhttps://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=1600&h=1067&fl=progressive&q=50&fm=jpg 1600w","sizes":"(min-width: 1600px) 1600px, 100vw"}},"layout":"constrained","width":1800,"height":1200,"placeholder":{"fallback":"data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEAlgCWAAD/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wAARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAMBAgb/xAAcEAACAgMBAQAAAAAAAAAAAAAAAQIREiExYeH/xAAWAQEBAQAAAAAAAAAAAAAAAAABAgP/xAAUEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwDK1DF0vgtxW9EylQu8nTotmo+gHfAEP//Z"}},"ogimg":{"src":"https://images.ctfassets.net/tushy4jlcik7/7uo9TsqFN9EBsDBqDJ5vXl/4c58a9f94babb15d8fd996c247737656/cover_dataengineering.jpg?w=1800&q=50"}},"body":{"childMarkdownRemark":{"timeToRead":5,"html":"<p>쿠버네티스 기반의 데이터플랫폼을 운영하다보면 이미지의 <code class=\"language-text\">ENTRYPOINT</code>에 <code class=\"language-text\">tini</code>, <code class=\"language-text\">dumb-init</code>과 같은 명령어를 사용하는 경우가 많습니다. 예를 들어 Airflow에서는 dumb-init을, SparkOperator에서는 tini를 사용하고 있습니다. 이 글에서는 컨테이너 환경에서 왜 이러한 초기화 시스템이 필요한지 알아보려 합니다.</p>\n<p><br><br></p>\n<h2 id=\"pid-1의-역할\" style=\"position:relative;\"><a href=\"#pid-1%EC%9D%98-%EC%97%AD%ED%95%A0\" aria-label=\"pid 1의 역할 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PID 1의 역할</h2>\n<p><span\n        class=\"gatsby-resp-image-wrapper\"\n        style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\"\n      >\n        <span\n          class=\"gatsby-resp-image-background-image\"\n          style=\"padding-bottom: 59.98293515358362%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAYCAMAAAC/Wk/yAAABg1BMVEUAAAAAAAAAAAAAAAAEFRwiJi4lQCoGKCwOKTMDKTMBKzUONT8SOUIFLTgBKjULMz0JMTsNND4DIy4EFhwDFhsCCw0dMTkYLTQXLDQUKzIUKzMPKTASNTsZPUENLzUOMTcLLTQZLTkfMDwKJjAKJDUJJDQKIzcIJDUJIzgJIzcLJjQlNEALKDIAAAAAAAAAAAARKzUTNDUJLDULLDcIMDoHMTsELjgCLDcGMDoCLTcIMTsFLzkLND4ROUMAKzYELjkDKDISOUMIMTwQN0EONkAQOEISOkMIMjwPN0ETOkQFLzoTOkMJMj0YPkgQOEEMNT8WPEYVPEUZP0gROUIJMjwNNT8MND8VPEY1VV09XGI+XGM/XWQ+XWNCYGZBX2ZDYGdAXmU9XGM6WWA7WmFFYmg8W2IKMz0BLDcMND4XPUcUO0QDLTgLMz4HMDsUO0UJMz0GMDsNNkACLTgKMz4NNUAVO0UROEIWPUYNMz4HMjwLNT8BLDYELTkDLDgAKzcBKzcBKzbhEENnAAAAMHRSTlMAAQIDE7W4uLi4uLi4uLi4uLi1KzAclZ6fn5+fn5+fn5+fn5+fn5+fn5+fnpUIFx0umrCDAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAB3RJTUUH6AoNADQwE+owaAAAAb9JREFUGBmFwUtPE1EAhuH3O3MO0xbGcglKMZCAF6IVAgsTVsa/7k6j0ZrGapAINUQQaBGGSi8zcyyYIHYWPI+QxG2891KgK1zTUOLU51qos9SqvKAr3kg+DYykfoguClyT6idWmpI33uiiKGngzqNeoePxBf7xXrJQSq3UD8ez9kQxDUvy2fg5ORZSFdoTaeyySitUqHM6zvK/GCxMShWVhbJFDZV6CwNGBDtY+DG2rJPs0JJMdaPTB+5gcmelzigDjG9/vtumWqXVbvrM+a8peRYYc51g7X0A63pNw836qTo5FlYPB7x5Tgq1Hjw9Okv2DTmBKbISb7S+ud0958vWlX937iQZI466BpL6PC4iiqhE02nDO3XJM4DlJgW/yuQZsMn2u2dQrXKv2fT4kq2ukmOgN+2exDFBAJuwvtgpva2TY2BtcVBjkzSl9gn64diKIy8wRV+JHzfa2e6eq7ZC1w3vaz9lxFHXwnx9ubbhPkYkrWlOH24lSaFPjuFSuN9jqN+G7y7pzpNnYXlyj6UtUlj68EjxwZKZ+cLQC71i6CU6nm0gM6NLnktGQ/ylm362rJ+TuI2fOxaSuI33/g+OJqt2WzDTvwAAABF0RVh0ZXhpZjpDb2xvclNwYWNlADEPmwJJAAAAE3RFWHRleGlmOkV4aWZPZmZzZXQAMTAyc0IppwAAABl0RVh0ZXhpZjpQaXhlbFhEaW1lbnNpb24AMjM0NLRs4C4AAAAZdEVYdGV4aWY6UGl4ZWxZRGltZW5zaW9uADE0MDaQDyaFAAAAGHRFWHRleGlmOlNvZnR3YXJlAFBob3RvU2NhcGV02ZskAAAAXHRFWHRleGlmOlVzZXJDb21tZW50ADY1LCA4MywgNjcsIDczLCA3MywgMCwgMCwgMCwgODMsIDk5LCAxMTQsIDEwMSwgMTAxLCAxMTAsIDExNSwgMTA0LCAxMTEsIDExNkC4H3IAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n        >\n          <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"cmd-top\"\n        title=\"\"\n        src=\"https://images.ctfassets.net/tushy4jlcik7/5IpajNkGdYFcuhxttrNIFk/0d3d9fa20afd459982cd8ab8d1e124e0/cmd-top.png\"\n        srcset=\"https://images.ctfassets.net/tushy4jlcik7/5IpajNkGdYFcuhxttrNIFk/0d3d9fa20afd459982cd8ab8d1e124e0/cmd-top.png?w=586 586w,\nhttps://images.ctfassets.net/tushy4jlcik7/5IpajNkGdYFcuhxttrNIFk/0d3d9fa20afd459982cd8ab8d1e124e0/cmd-top.png?w=1172 1172w,\nhttps://images.ctfassets.net/tushy4jlcik7/5IpajNkGdYFcuhxttrNIFk/0d3d9fa20afd459982cd8ab8d1e124e0/cmd-top.png?w=2344 2344w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n        </span>\n      </span></p>\n<p>리눅스에서 <strong>PID 1은 부팅 시 커널에 의해 최초로 실행되는 init 프로세스</strong>입니다.\ninit 프로세스는 SSH 데몬, Docker 데몬, Apache/Nginx 시작 등과 같은 시스템들의 시작을 담당합니다. 각 프로세스는 차례로 추가 하위 프로세스를 생성할 수 있습니다. PID 1은 결국 모든 프로세스의 최종 부모 프로세스 역할을 하게 됩니다. 현재 배포판들은 복잡한 init 대신 systemd가 초기화 시스템의 역할을 대신하고 있습니다.</p>\n<p><span\n        class=\"gatsby-resp-image-wrapper\"\n        style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\"\n      >\n        <span\n          class=\"gatsby-resp-image-background-image\"\n          style=\"padding-bottom: 63.26530612244898%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n        >\n          <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"zombie\"\n        title=\"\"\n        src=\"https://images.ctfassets.net/tushy4jlcik7/2iwB1DjFJYrpNpwdnTvWFP/88cfe34e3186e4809c377ce3ee5ba2a2/zombie.png\"\n        srcset=\"https://images.ctfassets.net/tushy4jlcik7/2iwB1DjFJYrpNpwdnTvWFP/88cfe34e3186e4809c377ce3ee5ba2a2/zombie.png?w=245 245w,\nhttps://images.ctfassets.net/tushy4jlcik7/2iwB1DjFJYrpNpwdnTvWFP/88cfe34e3186e4809c377ce3ee5ba2a2/zombie.png?w=490 490w,\nhttps://images.ctfassets.net/tushy4jlcik7/2iwB1DjFJYrpNpwdnTvWFP/88cfe34e3186e4809c377ce3ee5ba2a2/zombie.png?w=980 980w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n        </span>\n      </span></p>\n<p>여기까지는 일반적인 상황입니다. 만약 예기치 못한 상황으로 인해 프로세스가 종료되면 어떻게 될까요? bash(PID 5) 프로세스가 종료된다고 가정해보겠습니다. 5번은 이제 <strong>좀비 프로세스</strong>로 변합니다.</p>\n<p>왜 이런 일이 발생할까요? Unix는 부모 프로세스가 종료 상태를 수집하기 위해 자식 프로세스 종료를 명시적으로 대기하는 방식으로 설계되었기 때문입니다. 좀비 프로세스는 부모 프로세스가 시스템 호출의 <code class=\"language-text\">waitpid()</code> 시스템 명령을 수행할 때까지 존재합니다. 좀비를 제거하기 위해 자식 프로세스에서 <code class=\"language-text\">waitpid()</code>를 호출하는 작업을 <strong>reaping</strong>이라고 합니다.</p>\n<p>대부분의 경우 이러한 상황이 큰 문제가 되지 않습니다. 많은 어플리케이션이 자식 프로세스를 올바르게 가져옵니다. sshd를 사용하는 위의 예시에서 bash가 종료되면 운영 체제는 <code class=\"language-text\">SIGCHLD</code> 신호를 sshd에 보내 깨우게 합니다. sshd는 신호를 통해 인지하고 자식 프로세스를 거둡니다.</p>\n<p>하지만 부모 프로세스가 의도적으로 종료되거나 사용자가 프로세스를 종료시켰다고 가정해보겠습니다. 그러면 그 자식 프로세스들은 어떻게 될까요? 더 이상 상위 프로세스가 없으므로 **고아 상태(orphaned)**가 됩니다.</p>\n<p>init 프로세스는 이를 해결하기 위한 작업을 수행합니다. 바로 <strong>고아 상태가 된 자식 프로세스를 거두는 것(adopt)</strong> 입니다. init 프로세스에 의해 생성된 적이 없지만 프로세스의 부모가 되어 좀비 프로세스가 되지 않도록 정리해주는 역할을 합니다.</p>\n<p><span\n        class=\"gatsby-resp-image-wrapper\"\n        style=\"position: relative; display: block; ; max-width: 650px; margin-left: auto; margin-right: auto;\"\n      >\n        <span\n          class=\"gatsby-resp-image-background-image\"\n          style=\"padding-bottom: 65.2014652014652%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAaCAMAAADyku75AAAMYWlDQ1BpY2MAAEiJlVcHWFPJFp5bkpCQ0AKhSAm9CdKrlBBaBAGpgqiEJJBQYkwIKnZ0UcG1iyhWdFVE0bUAsqiIvSyKvS8WVJR1saAoKm9CArruK9873zczf86c+U/JzL13ANDs5UokeagWAPniAml8RAhzbGoak/QUoIAA9GHvyuXJJKy4uGgAZXD8u7y/ARDFeNVJwfXP+f8qOnyBjAcAkg5xJl/Gy4e4GQB8PU8iLQCAqNBbTimQKPAciHWlMECIVylwthLvVOBMJW4asEmMZ0N8GQA1KpcrzQZA4x7UMwt52ZBH4zPELmK+SAyA5nCIA3lCLh9iRezD8/MnKXAFxHbQXgIxjAf4ZH7Hmf03/swhfi43ewgr8xoQtVCRTJLHnfZ/luZ/S36efNCHDWxUoTQyXpE/rOGt3ElRCkyFuEucGROrqDXEvSK+su4AoBShPDJJaY8a82RsWD/AgNiFzw2NgtgY4nBxXky0Sp+ZJQrnQAx3CzpVVMBJhNgA4oUCWViCymazdFK8yhdalyVls1T6s1zpgF+Frwfy3CSWiv+NUMBR8WMaRcLEFIgpEFsVipJjINaA2FmWmxClshlZJGTHDNpI5fGK+K0gjheII0KU/FhhljQ8XmVfmi8bzBfbLBRxYlR4f4EwMVJZH+wkjzsQP8wFuywQs5IGeQSysdGDufAFoWHK3LHnAnFSgoqnV1IQEq9ci1MkeXEqe9xCkBeh0FtA7CErTFCtxZML4OZU8uNZkoK4RGWceFEOd1ScMh58GYgGbBAKmEAOWyaYBHKAqLWrvgv+Us6EAy6QgmwgAE4qzeCKlIEZMewTQBH4EyIBkA2tCxmYFYBCqP8ypFX2TiBrYLZwYEUueApxPogCefC3fGCVeMhbMngCNaJ/eOfCxoPx5sGmmP/3+kHtNw0LaqJVGvmgR6bmoCUxjBhKjCSGE+1xIzwQ98ejYR8Mmxvug/sO5vHNnvCU0EZ4RLhOaCfcnigqlv4Q5WjQDvnDVbXI/L4WuA3k9MRD8ADIDplxBm4EnHAP6IeFB0HPnlDLVsWtqArzB+6/ZfDdv6GyI7uQUbI+OZhs9+NKDQcNzyEWRa2/r48y1syherOHZn70z/6u+nw4Rv1oiS3EDmBnsOPYOawJqwdM7BjWgF3Ejijw0O56MrC7Br3FD8STC3lE//DHVflUVFLmUuPS6fJZOVcgmFqgOHjsSZJpUlG2sIDJgm8HAZMj5jkPZ7q5uLkBoHjXKB9fbxkD7xCEcf6bbh484wHi/v7+pm+6qE8AHDSHx7/9m872CnxMwOf02eU8ubRQqcMVHQE+JTThSTMEpsAS2MF83IAX8AfBIAyMArEgEaSCCbDKQrjPpWAKmAHmghJQBpaB1WAd2AS2gp1gD9gP6kETOA5OgwvgMrgO7sLd0wFegm7wHvQhCEJCaAgdMUTMEGvEEXFDfJBAJAyJRuKRVCQDyUbEiByZgcxDypAVyDpkC1KN/IocRo4j55A25DbyEOlE3iCfUAylorqoCWqDjkB9UBYahSai49FsdDJahM5Hl6AVaBW6G61Dj6MX0OtoO/oS7cEApo4xMHPMCfPB2FgsloZlYVJsFlaKlWNVWC3WCP/nq1g71oV9xIk4HWfiTnAHR+JJOA+fjM/CF+Pr8J14HX4Sv4o/xLvxrwQawZjgSPAjcAhjCdmEKYQSQjlhO+EQ4RQ8Sx2E90QikUG0JXrDs5hKzCFOJy4mbiDuJTYT24iPiT0kEsmQ5EgKIMWSuKQCUglpLWk36RjpCqmD1Kumrmam5qYWrpamJlYrVitX26V2VO2K2jO1PrIW2ZrsR44l88nTyEvJ28iN5EvkDnIfRZtiSwmgJFJyKHMpFZRayinKPcpbdXV1C3Vf9THqIvU56hXq+9TPqj9U/0jVoTpQ2dR0qpy6hLqD2ky9TX1Lo9FsaMG0NFoBbQmtmnaC9oDWq0HXcNbgaPA1ZmtUatRpXNF4pUnWtNZkaU7QLNIs1zygeUmzS4usZaPF1uJqzdKq1DqsdVOrR5uu7aodq52vvVh7l/Y57ec6JB0bnTAdvs58na06J3Qe0zG6JZ1N59Hn0bfRT9E7dIm6troc3RzdMt09uq263Xo6eh56yXpT9Sr1jui1MzCGDYPDyGMsZexn3GB80jfRZ+kL9Bfp1+pf0f9gMMwg2EBgUGqw1+C6wSdDpmGYYa7hcsN6w/tGuJGD0RijKUYbjU4ZdQ3THeY/jDesdNj+YXeMUWMH43jj6cZbjS8a95iYmkSYSEzWmpww6TJlmAab5piuMj1q2mlGNws0E5mtMjtm9oKpx2Qx85gVzJPMbnNj80hzufkW81bzPgtbiySLYou9FvctKZY+llmWqyxbLLutzKxGW82wqrG6Y0229rEWWq+xPmP9wcbWJsVmgU29zXNbA1uObZFtje09O5pdkN1kuyq7a/ZEex/7XPsN9pcdUAdPB6FDpcMlR9TRy1HkuMGxbThhuO9w8fCq4TedqE4sp0KnGqeHzgznaOdi53rnVyOsRqSNWD7izIivLp4ueS7bXO666riOci12bXR94+bgxnOrdLvmTnMPd5/t3uD+2sPRQ+Cx0eOWJ91ztOcCzxbPL17eXlKvWq9ObyvvDO/13jd9dH3ifBb7nPUl+Ib4zvZt8v3o5+VX4Lff7y9/J/9c/13+z0fajhSM3DbycYBFADdgS0B7IDMwI3BzYHuQeRA3qCroUbBlMD94e/Azlj0rh7Wb9SrEJUQacijkA9uPPZPdHIqFRoSWhraG6YQlha0LexBuEZ4dXhPeHeEZMT2iOZIQGRW5PPImx4TD41Rzukd5j5o56mQUNSohal3Uo2iHaGl042h09KjRK0ffi7GOEcfUx4JYTuzK2PtxtnGT434bQxwTN6ZyzNN41/gZ8WcS6AkTE3YlvE8MSVyaeDfJLkme1JKsmZyeXJ38ISU0ZUVK+9gRY2eOvZBqlCpKbUgjpSWnbU/rGRc2bvW4jnTP9JL0G+Ntx08df26C0YS8CUcmak7kTjyQQchIydiV8Zkby63i9mRyMtdndvPYvDW8l/xg/ip+pyBAsELwLCsga0XW8+yA7JXZncIgYbmwS8QWrRO9zonM2ZTzITc2d0duf15K3t58tfyM/MNiHXGu+OQk00lTJ7VJHCUlkvbJfpNXT+6WRkm3yxDZeFlDgS78qL8ot5P/JH9YGFhYWdg7JXnKganaU8VTL05zmLZo2rOi8KJfpuPTedNbZpjPmDvj4UzWzC2zkFmZs1pmW86eP7tjTsScnXMpc3Pn/l7sUryi+N28lHmN803mz5n/+KeIn2pKNEqkJTcX+C/YtBBfKFrYush90dpFX0v5pefLXMrKyz4v5i0+/7PrzxU/9y/JWtK61GvpxmXEZeJlN5YHLd+5QntF0YrHK0evrFvFXFW66t3qiavPlXuUb1pDWSNf014RXdGw1mrtsrWf1wnXXa8Mqdy73nj9ovUfNvA3XNkYvLF2k8mmsk2fNos239oSsaWuyqaqfCtxa+HWp9uSt535xeeX6u1G28u2f9kh3tG+M37nyWrv6updxruW1qA18prO3em7L+8J3dNQ61S7ZS9jb9k+sE++78WvGb/e2B+1v+WAz4Hag9YH1x+iHyqtQ+qm1XXXC+vbG1Ib2g6POtzS6N946Dfn33Y0mTdVHtE7svQo5ej8o/3Hio71NEuau45nH3/cMrHl7omxJ66dHHOy9VTUqbOnw0+fOMM6c+xswNmmc37nDp/3OV9/wetC3UXPi4d+9/z9UKtXa90l70sNl30vN7aNbDt6JejK8auhV09f41y7cD3metuNpBu3bqbfbL/Fv/X8dt7t13cK7/TdnXOPcK/0vtb98gfGD6r+sP9jb7tX+5GHoQ8vPkp4dPcx7/HLJ7InnzvmP6U9LX9m9qz6udvzps7wzssvxr3oeCl52ddV8qf2n+tf2b06+FfwXxe7x3Z3vJa+7n+z+K3h2x3vPN619MT1PHif/77vQ2mvYe/Ojz4fz3xK+fSsb8pn0ueKL/ZfGr9Gfb3Xn9/fL+FKuQOfAhhsaFYWAG92AEBLBYAO722Uccq74IAgyvvrAAL/CSvviwPiBUAtHBSf8exmAPbBZjMHcsOm+IRPDAaou/tQU4ksy91NyUWFNyFCb3//WxMASI0AfJH29/dt6O//sg0GexuA5snKO6hCiPDOsDlAga4bpPeCH0R5P/0uxx9HoIjAA/w4/gvp7JAEsYT/TAAAAP9QTFRF////+/v7+vr69/f35eXl7Ozs9PT08vLy3d3d7e3t1dXV6urq6Ojo/Pz8/v7+5ubm8fHx6enp+fn5+Pj44+Pj9vb21NTU4uLi4eHh8PDw7u7u1tbW5+fn39/f09PT3t7e4ODg2trat7e329vby8vL19fX5OTk9fX1zMzMxsbGzc3N/f398/PzyMjI3NzcwcHBx8fH0dHRxMTE2dnZvb29/Pjx+fPn8uzgzsi7z8m9ysS31M7C/fv20tLS9uXL+uTL7uLOzs7O9ubN++bP+eTN897I8NzG+eTO0NDQ5tO+w7Ohyrmn4c651MOv7trEycnJxcXFw8PD8+rb6dzH8OrfZkNvDQAAAAlwSFlzAAAWJQAAFiUBSVIk8AAAAAd0SU1FB+gKDQA0L57iPZ0AAAFgSURBVDjLtZJpV4JAFIZHyAFCFMiEEhQrA5eysmwlKVpsX///b+nCXBDTyi+958zow31m5swFQuZPbgK4LPET4kKehUYgiAykuLSIJbZaxgUFJQPFEkySkuwVz3lCqKASoukMlqgK/8oMcgJdZhBjxTDHYkE0V1JxtSpbGZEdrWeAGN8BBNu2azDEIgBFqMOmRHGQrPTm6dop+I1+KjUgazDW4z5qmrZRhomfIeJvM7rMpoups4ea12qPxU6uqKqJSAUqyV1XxMbzJX4s1rbK9nYimr2d6q6ciH8fPUNseZ7Xg7EXfUalPsaaFqdpvj4qedWlM0um4zj7MOIXejA4PDo+OR0MzgBcB0tMrugsfnSZ8yEmAOhjRb9Ibt0hcFp868swvAqvb27DAPvR4bocGaHot4xmIxHv7h8en55RpC9tw5dSMdNH2JElyFRQfPVY3qI+vn9gPgEsrHgj8g/5AstAMF/bQC0SAAAAEnRFWHRleGlmOkV4aWZPZmZzZXQANzjJ1HsnAAAAGXRFWHRleGlmOlBpeGVsWERpbWVuc2lvbgAxMDky+FIq4QAAABh0RVh0ZXhpZjpQaXhlbFlEaW1lbnNpb24ANzEyKKWNxAAAAFx0RVh0ZXhpZjpVc2VyQ29tbWVudAA2NSwgODMsIDY3LCA3MywgNzMsIDAsIDAsIDAsIDgzLCA5OSwgMTE0LCAxMDEsIDEwMSwgMTEwLCAxMTUsIDEwNCwgMTExLCAxMTZAuB9yAAAAKHRFWHRpY2M6Y29weXJpZ2h0AENvcHlyaWdodCBBcHBsZSBJbmMuLCAyMDIy5LS/nAAAABd0RVh0aWNjOmRlc2NyaXB0aW9uAERpc3BsYXkXG5W4AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n        >\n          <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"adopted\"\n        title=\"\"\n        src=\"https://images.ctfassets.net/tushy4jlcik7/3jR6W6RtoYEMOVbsaytJWr/a4d815b4a092d1695606fd1978b9d8d4/adopted.png\"\n        srcset=\"https://images.ctfassets.net/tushy4jlcik7/3jR6W6RtoYEMOVbsaytJWr/a4d815b4a092d1695606fd1978b9d8d4/adopted.png?w=273 273w,\nhttps://images.ctfassets.net/tushy4jlcik7/3jR6W6RtoYEMOVbsaytJWr/a4d815b4a092d1695606fd1978b9d8d4/adopted.png?w=546 546w,\nhttps://images.ctfassets.net/tushy4jlcik7/3jR6W6RtoYEMOVbsaytJWr/a4d815b4a092d1695606fd1978b9d8d4/adopted.png?w=1092 1092w\"\n        sizes=\"(max-width: 650px) 100vw, 650px\"\n        loading=\"lazy\"\n      />\n        </span>\n      </span></p>\n<p>백그라운드에서 실행되는 nginx 프로세스를 예시로 들어보겠습니다. 먼저 nginx는 자식 프로세스를 만듭니다. 그리고 nginx 프로세스가 종료됩니다. 고아가 된 nginx 자식 프로세스는 init 프로세스가 거두어들입니다.</p>\n<p>이러한 init 프로세스의 역할 덕분에 우리는 어플리케이션을 개발할 때 크게 신경쓰지 않게 되었습니다. 하지만 쿠버네티스를 포함한 컨테이너 환경의 경우, 조금 다릅니다.</p>\n<br>\n<h2 id=\"컨테이너-내부에서의-프로세스-동작\" style=\"position:relative;\"><a href=\"#%EC%BB%A8%ED%85%8C%EC%9D%B4%EB%84%88-%EB%82%B4%EB%B6%80%EC%97%90%EC%84%9C%EC%9D%98-%ED%94%84%EB%A1%9C%EC%84%B8%EC%8A%A4-%EB%8F%99%EC%9E%91\" aria-label=\"컨테이너 내부에서의 프로세스 동작 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>컨테이너 내부에서의 프로세스 동작</h2>\n<p>도커는 컨테이너 ENTRYPOINT(CMD)로 명시된 프로세스를 PID 1로써 새로운 PID 네임스페이스에 정의합니다. 그리고 컨테이너 내부에 있는 PID 1 프로세스에만 신호를 보내 종료할 수 있습니다. 이러한 이유로 컨테이너는 경량화 이미지를 기반으로 단일 프로세스만 실행하는 경우가 많습니다. 두 가지 예시를 살펴보겠습니다.</p>\n<p><strong>1. sh 프로세스가 PID 1인 경우</strong><br>\nDockerfile을 통해 다음과 같은 컨테이너 명령을 지정하면 실행을 위해 쉘에 전달됩니다. 그 결과 아래와 같은 프로세스 트리가 생성됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- docker run (on the host machine)\n  - /bin/sh (PID 1, inside container)\n    - python my_server.py (PID 2, inside container)</code></pre></div>\n<p>쉘을 PID 1로 사용하면 실제로 2번 프로세스에 signal를 보내는 것이 거의 불가능합니다. 쉘로 보낸 신호는 하위 프로세스로 전달되지 않으며 프로세스가 완료될 때까지 셸이 종료되지 않습니다. 이 경우 컨테이너를 종료하기 위해 SIGKILL을 보내야 합니다.</p>\n<p><strong>2. 내 프로세스가 PID 1인 경우</strong><br>\nDockerfile에서 다음과 같이 정의하면 프로세스가 즉시 시작되고 컨테이너의 초기화 시스템으로써 작동하여 다음과 같은 프로세스 트리가 생성됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- docker run (on the host machine)\n  - python my_server.py (PID 1, inside container)</code></pre></div>\n<p>이러한 구조가 1번 예시보다 나은 방법입니다. 프로세스는 이제 실제로 보내는 신호를 수신합니다. 그러나 PID 1이므로 예상대로 응답하지 않을 수 있습니다.</p>\n<br>\n<h2 id=\"pid-1의-signal-propagation-문제\" style=\"position:relative;\"><a href=\"#pid-1%EC%9D%98-signal-propagation-%EB%AC%B8%EC%A0%9C\" aria-label=\"pid 1의 signal propagation 문제 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>PID 1의 Signal Propagation 문제</h2>\n<p>컨테이너 환경도 마찬가지로 PID 1은 초기화 시스템의 책임이 있습니다.\n일반적인 프로세스는 <code class=\"language-text\">TERM</code>에 대한 자체 handler를 등록하여 종료하기 전 cleanup을 수행할 수 있습니다. 프로세스가 signal handler를 등록하지 않은 경우, 커널은 일반적으로 <code class=\"language-text\">TERM</code> 신호에 대한 기본 동작인 프로세스 종료를 수행합니다.</p>\n<p>반면 PID 1은 <code class=\"language-text\">TERM</code> 신호에 대해 기본 동작으로 실행되지 않습니다. 따라서 signal handler를 등록하지 않은 경우, <code class=\"language-text\">TERM</code>은 프로세스에 아무런 영향도 미치지 못합니다.\n만약 자식 프로세스가 하위 프로세스를 생성하고 먼저 죽었다면, 컨테이너 상에 좀비 프로세스가 계속 쌓일 수 있습니다.</p>\n<p>docker run이 <code class=\"language-text\">SIGTERM</code>을 수신하면 컨테이너 자체가 죽지 않더라도 신호를 컨테이너로 전달한 다음 종료됩니다. docker stop 명령을 사용해도 마찬가지입니다. <code class=\"language-text\">TERM</code> signal을 보내고 10초 동안 기다린 다음 프로세스가 여전히 중지되지 않으면 KILL이 전송되어 정리할 기회 없이 즉시 중지됩니다.</p>\n<br>\n<h2 id=\"dumb-init\" style=\"position:relative;\"><a href=\"#dumb-init\" aria-label=\"dumb init permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>dumb-init</h2>\n<p>dumb-init은 이러한 문제를 해결하고 컨테이너를 일반 프로세스와 같은 형태로 사용할 수 있도록 지원하기 위해 만들어졌습니다. systemd과 달리 컨테이너에서 사용하기 위해 경량화된 형태로 개발된 초기화 시스템입니다. dumb-init을 사용하면 다음과 같은 프로세스 트리가 생성됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">- docker run (on the host machine)\n  - dumb-init (PID 1, inside container)\n    - python my_server.py (PID 2, inside container)</code></pre></div>\n<p>dumb-init은 모든 signal에 대해 signal handler를 등록하고 해당 signal을 프로세스 세션으로 전달합니다. 파이썬 프로세스는 더 이상 PID 1로 실행되지 않기 때문에 dumb-init이 <code class=\"language-text\">TERM</code>과 같은 신호를 전달할 때 handler를 등록하지 않아도 프로세스 종료가 가능합니다. dumb-init은 signal propagation 뿐만 아니라 고아 상태가 된 자식 프로세스를 거두는 역할(adopt)도 수행합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"docker\"><pre class=\"language-docker\"><code class=\"language-docker\"><span class=\"token instruction\"><span class=\"token keyword\">RUN</span> apt install dumb-init</span>\n<span class=\"token instruction\"><span class=\"token keyword\">ENTRYPOINT</span> [<span class=\"token string\">\"/usr/bin/dumb-init\"</span>, <span class=\"token string\">\"--\"</span>, <span class=\"token string\">\"/my/script\"</span>]</span></code></pre></div>\n<p>사용 방법은 정말 간단합니다. 이미지에 바이너리를 설치하고 명령어 실행할 때 추가하면 됩니다.</p>\n<br>\n<h2 id=\"airflow-이미지에서-dumb-init-사용\" style=\"position:relative;\"><a href=\"#airflow-%EC%9D%B4%EB%AF%B8%EC%A7%80%EC%97%90%EC%84%9C-dumb-init-%EC%82%AC%EC%9A%A9\" aria-label=\"airflow 이미지에서 dumb init 사용 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Airflow 이미지에서 dumb-init 사용</h2>\n<p>Airflow도 dumb-init를 ENTRYPOINT에서 사용하고 있습니다. webserver, worker, scheduler pod에서 <code class=\"language-text\">bash -c ENTRYPOINT</code>를 사용하는데 bash는 자식에게 signal을 전달 안하기 때문에 dumb-init 사용이 필요합니다. 컨테이너 내에서는 환경변수를 통해 다르게 설정할 수 있도록 지원하고 있습니다. 설정 값의 차이는 아래와 같습니다.</p>\n<ul>\n<li><code class=\"language-text\">DUMB_INIT_SETSID=1</code> : 메인 프로세스 그룹의 모든 프로세스에 SIGNAL 전파</li>\n<li><code class=\"language-text\">DUMB_INIT_SETSID=0</code> : 메인 프로세스에만 SIGNAL 전파</li>\n</ul>\n<p>공식 차트에서 worker pod은 0으로 나머지는 1로 설정되어 있습니다.<br>\n이유는 Celery Worker의 warm shutdown을 지원하기 위해서 입니다. 특히 Airflow on Kubernetes 구성에서 CeleryExecutor를 사용하는 경우, task의 정상적인 종료를 위해 필요합니다. 이 부분은 다음 포스트에 이어서 정리해보겠습니다.</p>\n<br>\n<h2 id=\"reference\" style=\"position:relative;\"><a href=\"#reference\" aria-label=\"reference permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Reference</h2>\n<ul>\n<li><a href=\"https://blog.phusion.nl/2015/01/20/docker-and-the-pid-1-zombie-reaping-problem/\">https://blog.phusion.nl/2015/01/20/docker-and-the-pid-1-zombie-reaping-problem/</a></li>\n<li><a href=\"https://engineeringblog.yelp.com/2016/01/dumb-init-an-init-for-docker.html\">https://engineeringblog.yelp.com/2016/01/dumb-init-an-init-for-docker.html</a></li>\n<li><a href=\"https://github.com/Yelp/dumb-init\">https://github.com/Yelp/dumb-init</a></li>\n<li><a href=\"https://airflow.apache.org/docs/docker-stack/entrypoint.html\">https://airflow.apache.org/docs/docker-stack/entrypoint.html</a></li>\n</ul>","excerpt":"쿠버네티스 기반의 데이터플랫폼을 운영하다보면 이미지의 에 , 과 같은 명령어를 사용하는 경우가 많습니다. 예를 들어 Airflow에서는 dumb-init을, SparkOperator에서는 tini를 사용하고 있습니다. 이 글에서는 컨테이너 환경에서 왜 이러한 초기화 시스템이 필요한지 알아보려 합니다.  PID 1의 역할  리눅스에서 PID 1은 부팅 시 커널에 의해 최초로 실행되는 init 프로세스입니다.\ninit 프로세스는 SSH 데몬, Docker 데몬, Apache/Nginx…"}}}},"pageContext":{"slug":"container-tini-dumb-init","basePath":"","prev":{"slug":"airflow-worker-keda-autoscaler","publishDate":"2022-06-24"},"next":{"slug":"eks-karpenter-groupless-autoscaling","publishDate":"2022-05-13"}}},"staticQueryHashes":["1946181227","2744905544","3732430097"]}