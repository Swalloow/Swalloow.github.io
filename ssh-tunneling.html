<!DOCTYPE html>
<html lang="ko">
<head>
    <!-- [[! Document Settings ]] -->
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <!-- [[! Page Meta ]] -->
    <title>SSH 프로토콜과 Tunneling 이해하기</title>

    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="shortcut icon" href="/assets/images/favicon.ico" >

    <!-- [[! Styles'n'Scripts ]] -->
    <link rel="stylesheet" type="text/css" href="/assets/css/screen.css" />
    <link rel="stylesheet" type="text/css"
          href="//fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic|Open+Sans:700,400" />
    <link rel="stylesheet" type="text/css" href="/assets/css/syntax.css" />

    <!-- [[! highlight.js ]] -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/styles/default.min.css">
    <style>.hljs { background: none; }</style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.3.0/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- [[! Ghost outputs important style and meta data with this tag ]] -->
        <link rel="canonical" href="/" />
    <meta name="referrer" content="origin" />
    <link rel="next" href="/page2/" />

    
        <meta property="og:site_name" content="Swalloow Blog" />
        <meta property="og:type" content="website" />
        <meta property="og:title" content="SSH 프로토콜과 Tunneling 이해하기" />
        <meta property="og:description" content="About Data Science, Data Engineering" />
        <meta property="og:url" content="/" />
        <meta property="og:image" content="/assets/images/cover_main.jpg" />
    

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Swalloow Blog" />
    <meta name="twitter:description" content="About Data Science, Data Engineering" />
    <meta name="twitter:url" content="/" />
    <meta name="twitter:image:src" content="/assets/images/cover_main.jpg" />

    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Website",
    "publisher": "Swalloow Blog",
    "url": "/",
    "image": "/assets/images/cover_main.jpg",
    "description": "About Data Science, Data Engineering"
}
    </script>

    <meta name="generator" content="Jekyll 3.0.0" />
    <link rel="alternate" type="application/rss+xml" title="Swalloow Blog" href="/feed.xml" />

</head>
<body class="home-template nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
        <li class="nav-home " role="presentation"><a href="/">Home</a></li>
        <li class="nav-about " role="presentation"><a href="/about">About</a></li>
        <li class="nav-personal " role="presentation"><a href="/tag/Personal">Personal</a></li>
        <li class="nav-develop " role="presentation"><a href="/tag/Develop">Develop</a></li>
        <li class="nav-devops " role="presentation"><a href="/tag/DevOps">DevOps</a></li>
        <li class="nav-datascience " role="presentation"><a href="/tag/DataScience">DataScience</a></li>
        <li class="nav-dataengineering " role="presentation"><a href="/tag/DataEngineering">DataEngineering</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="/feed.xml">Subscribe</a>
</div>
<span class="nav-cover"></span>


    <div class="site-wrapper">

        <!-- [[! Everything else gets inserted here ]] -->
        <!-- < default -->

<!-- The comment above "< default" means - insert everything in this file into -->
    <!-- the [body] of the default.hbs template, which contains our header/footer. -->

<!-- Everything inside the #post tags pulls data from the post -->
<!-- #post -->

<header class="main-header post-head no-cover">
    <nav class="main-nav  clearfix">
        <a class="blog-logo" href="/"><img src="/assets/images/ghost.png" alt="Blog Logo" /></a>
        
            <a class="menu-button icon-menu" href="#"><span class="word">Menu</span></a>
        
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-DevOps">

        <header class="post-header">
            <h1 class="post-title">SSH 프로토콜과 Tunneling 이해하기</h1>
            <section class="post-meta">
            <!-- <a href='/'>Swalloow</a> -->
            <time class="post-date" datetime="2017-03-20">20 Mar 2017</time>
                <!-- [[tags prefix=" on "]] -->
                
                on
                
                    
                       <a href='/tag/DevOps'>Devops</a>
                    
                
                
            </section>
        </header>

        <section class="post-content">

            <p>​   ​</p>

<p>지금까지 아무 생각없이 SSH를 사용하다가 한번 정리해보았습니다.</p>

<p>​   ​</p>

<h2 id="ssh-protocol">SSH Protocol</h2>

<p>SSH는 Secure Shell의 약자입니다. SSH는 한마디로 정의하면,
네트워크 상의 다른 컴퓨터에 로그인하거나 원격 시스템에서 명령을 실행하고
다른 시스템으로 파일을 복사할 수 있도록 해 주는 프로토콜입니다.
VPN을 구성하는 것보다 가격이 저렴하고 쉽게 연결할 수 있어 많이 사용됩니다.</p>

<p>MacOS에는 <strong>OpenSSH</strong> 클라이언트와 서버가 내장되어 있기 때문에 바로 사용할 수 있습니다.
SSH는 <strong>22번 포트</strong> 를 사용하며, 크게 다음의 3가지를 제공합니다.</p>

<p>​   ​</p>

<h4 id="authentication">1. Authentication</h4>

<p><img src="/assets/images/ssh-key-auth-flow.png" alt="SSH-Auth" /></p>

<p>SSH는 public key와 private key를 사용하는 비대칭 암호방식을 사용합니다.
간단히 설명하면, <code class="highlighter-rouge">public key</code>와 <code class="highlighter-rouge">private key</code>가 모두 있어야 인증이 되는 방식입니다.
각자 private key는 외부 유출없이 가지고 있고, public key만 네트워크를 통해 전달합니다.
SSH는 RSA, DSA 등 다양한 인증 방식을 지원합니다.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>ssh-keygen
<span class="gp">$ </span>cat ~/.ssh/id_rsa.pub</code></pre></figure>

<p><code class="highlighter-rouge">ssh-keygen</code> 명령어를 통해 ssh 키를 생성하고
<code class="highlighter-rouge">~/.ssh/id_rsa.pub</code>에서 public key를 확인할 수 있습니다.</p>

<p>​   ​</p>

<h4 id="encryption--integrity">2. Encryption &amp; Integrity</h4>

<p>SSH는 네트워크를 통해 전달되는 데이터를 암호화합니다.
<code class="highlighter-rouge">3DES, blowfish</code> 등 여러 가지 암호화 방식을 제공하며,
새로운 암호화 기법을 추가할 수도 있습니다.</p>

<p>그리고 SSH는 네트워크를 통해 받은 데이터가 변경되지 않았음(무결성)을 보장해줍니다.
이를 위해 <strong>MAC(Message Authentication Code)</strong> 이라는 알고리즘을 사용합니다.</p>

<p><img src="/assets/images/mac-algo.jpg" alt="MAC-Algo" /></p>

<p>MAC 알고리즘은 다음과 같이 동작합니다.
SSH 클라이언트가 서버로 메세지를 보내면,
MAC 알고리즘을 통해 <code class="highlighter-rouge">secret key</code>를 입력받아 MAC 코드를 생성합니다.
그리고, 임의 길이의 암호화 된 메시지와 MAC 코드를 SSH 서버로 보냅니다.</p>

<p>서버에서는 다시 메세지와 서버의 <code class="highlighter-rouge">secret key</code>를 조합하여 MAC 코드를 만들고,
클라이언트로부터 받은 MAC 코드와 비교하여 인증을 진행하게 됩니다.</p>

<p>​   ​</p>

<h4 id="compression">4. Compression</h4>

<p>SSH는 네트워크 상에서 데이터를 전송하고 수신할 때 압축 과정을 거칩니다.
이를 통해 전송 데이터의 크기를 줄여 네트워크 비용을 낮출 수 있습니다.</p>

<p>​   ​</p>

<h2 id="ssh-tunneling">SSH Tunneling</h2>

<p>SSH Tunneling은 터널을 통해 데이터를 주고받는다 해서 붙여진 이름입니다.
앞서 얘기했던 것처럼 연결, 통신은 모두 암호화되며 <code class="highlighter-rouge">SMTP, IMAP</code> 등 여러 가지로 사용될 수 있습니다.</p>

<p>Direct로 보내면 네트워크 층에서 수 많은 공격을 받을 수 있기 때문에
SSH를 통해 다른 Application에 연결하는 것이 안전합니다.
SSH Tunneling에는 다음과 같이 두 가지 방법이 있습니다.</p>

<p>​   ​</p>

<h4 id="local-port-forwarding">Local port forwarding</h4>

<p><img src="/assets/images/ssh-local.png" alt="SSH-Local" /></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>ssh -L port1:host_name:port2 server_name</code></pre></figure>

<p>로컬에서 서버에 있는 MySQL과 SSH 연결을 한다고 가정해보겠습니다.
<code class="highlighter-rouge">Local port forwarding</code>은
로컬에 설치된 MySQL 클라이언트의 3306 포트가
연결된 SSH Tunnel을 거쳐 서버에 있는 MySQL 서버의 3306 포트와 연결됩니다.
이를 통해 직접 서버의 데이터베이스에 안전하게 접근할 수 있으며
요청을 보내서 서로 데이터를 주고 받을 수 있습니다.</p>

<p>​   ​</p>

<h4 id="remote-port-forwarding">Remote port forwarding</h4>

<p><img src="/assets/images/ssh-remote.png" alt="SSH-Remote" /></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="gp">$ </span>ssh -R port1:host_name:port2 server_name</code></pre></figure>

<p>이번에는 로컬에서 파이썬 웹 애플리케이션을 개발 중인데 친구에게 보여주고 싶다고 가정 해보겠습니다.
아직 공개 IP 주소를 제공하지 않기 때문에 인터넷을 통해 직접 기기에 연결할 수 없을 겁니다.
라우터에서 NAT를 구성하여 해결할 수 있지만 라우터의 구성을 변경해야하므로 번거롭습니다.
이럴때 <code class="highlighter-rouge">Remote port forwarding</code>을 통해 쉽게 해결할 수 있습니다.</p>

<p>먼저 port1의 서버에서 port2로 로컬 트래픽을 전달하는 SSH 터널을 생성합니다.
이후 로컬에서 port2의 서버에 연결하면 실제로 SSH 터널을 통해 데이터를 요청하는 것을 확인할 수 있습니다.</p>

<p>OSI 7계층에서 생각해보면 SSH는 <code class="highlighter-rouge">Application - Transport - Network</code> 계층에 걸쳐있습니다.
Application 계층에서 포트를 연결하면 Transport 계층의 TCP 통신을 통해 전달되고,
Network 계층을 통해 목적지로 이동하게 됩니다.</p>

<p>​   ​</p>


        </section>

        <footer class="post-footer">

            <!-- Everything inside the #author tags pulls data from the author -->
            <!-- #author-->

            
            <figure class="author-image">
                <a class="img" href="/author/Swalloow" style="background-image: url(/assets/images/avatar.png)"><span class="hidden">'s Picture</span></a>
            </figure>
            

            <section class="author">
                <h4><a href="/author/Swalloow">Swalloow</a></h4>

                
                    <p> Interested in Data Science & Engineering</p>
                
                <div class="author-meta">
                    <span class="author-location icon-location"> Seoul, Korea</span>
                    <span class="author-link icon-link"><a href="http://swalloow.github.io/"> swalloow.github.io/</a></span>
                </div>
            </section>

            <!-- /author  -->

            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="http://twitter.com/share?text=SSH 프로토콜과 Tunneling 이해하기&amp;url=http://swalloow.github.io/ssh-tunneling"
                    onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://swalloow.github.io/ssh-tunneling"
                    onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://swalloow.github.io/ssh-tunneling"
                   onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>

            <!-- Add Disqus Comments -->
            
                <div id="disqus_thread"></div>
<script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'swalloow'; // required: replace example with your forum shortname
        var disqus_identifier = '/ssh-tunneling';
        var disqus_url = 'http://swalloow.github.io//ssh-tunneling';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>

            

        </footer>

    </article>

</main>

<aside class="read-next">

    <!-- [[! next_post ]] -->
    
        <a class="read-next-story no-cover" href="/jupyter-spark">
            <section class="post">
                <h2>Jupyter에서 Scala로 Spark 사용하는 방법</h2>
                <p>​ ​ 이 글은 평소에 **Jupyter Notebook** 에 익숙해져있는 분들께 유용할 듯 합니다. Zeppelin Notebook을...</p>
            </section>
        </a>
    
    <!-- [[! /next_post ]] -->
    <!-- [[! prev_post ]] -->
    
        <a class="read-next-story prev " style="background-image: url(/assets/images/cover_personal.jpg)" href="/developer-roadmap">
            <section class="post">
                <h2>Awesome Developer Roadmap</h2>
                <p>​ https://github.com/kamranahmedse/developer-roadmap 오직 Awesome만으로 별 1만개를 넘게 달았다. 저분 GitHub에 들어가보니 완전 Awesome 전문가이시다. 그래도...</p>
            </section>
        </a>
    
    <!-- [[! /prev_post ]] -->
</aside>

<!-- /post -->


        <footer class="site-footer clearfix">
          <section class="copyright"><a href="/">Swalloow Blog</a> &copy; 2017</section>
          <section class="poweredby">Proudly published with <a href="https://jekyllrb.com/">Jekyll</a> using <a href="https://github.com/biomadeira/jasper">Jasper</a></section>
        </footer>
    </div>
    <!-- [[! Ghost outputs important scripts and data with this tag ]] -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-1.11.3.min.js"></script>
    <!-- [[! The main JavaScript file for Casper ]] -->
    <script type="text/javascript" src="/assets/js/jquery.fitvids.js"></script>
    <script type="text/javascript" src="/assets/js/index.js"></script>

    <!-- Add Google Analytics  -->
        <!-- Google Analytics Tracking code -->
     <script>
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-89689523-1', 'auto');
	    ga('send', 'pageview');

     </script>
</body>
</html>
